# Middleware íŒŒì¼ í†µí•© ë¶„ì„

## ğŸ“Š í˜„ì¬ íŒŒì¼ êµ¬ì¡°

```
app/domain/langgraph/middleware/
â”œâ”€â”€ __init__.py          (24ì¤„)
â”œâ”€â”€ factory.py           (66ì¤„)
â”œâ”€â”€ rate_limiting.py     (135ì¤„)
â”œâ”€â”€ retry.py             (153ì¤„)
â”œâ”€â”€ logging.py           (144ì¤„)
â””â”€â”€ example_usage.py     (208ì¤„) - ì°¸ê³ ìš©
```

**ì´ ë¼ì¸ ìˆ˜**: ì•½ 498ì¤„ (example_usage.py ì œì™¸)

---

## ğŸ” í†µí•© ê°€ëŠ¥ì„± ë¶„ì„

### í˜„ì¬ ì‚¬ìš© íŒ¨í„´

#### 1. ë…¸ë“œì—ì„œì˜ ì‚¬ìš©
```python
# intent_analyzer.py, writer.py
from app.domain.langgraph.middleware import wrap_chain_with_middleware
```
- âœ… Factory í•¨ìˆ˜ë§Œ ì‚¬ìš©
- âœ… ê°œë³„ Middleware ì§ì ‘ ì‚¬ìš© ì•ˆ í•¨

#### 2. í…ŒìŠ¤íŠ¸ì—ì„œì˜ ì‚¬ìš©
```python
# test_middleware.py
from app.domain.langgraph.middleware import (
    RateLimitingMiddleware,
    RetryMiddleware,
    LoggingMiddleware
)
```
- âš ï¸ ê°œë³„ Middleware ì§ì ‘ ì‚¬ìš©
- âš ï¸ í†µí•© ì‹œì—ë„ `__init__.py`ì—ì„œ exportí•˜ë©´ ë¬¸ì œ ì—†ìŒ

#### 3. Factoryì—ì„œì˜ ì‚¬ìš©
```python
# factory.py
from app.domain.langgraph.middleware import (
    RateLimitingMiddleware,
    RetryMiddleware,
    LoggingMiddleware
)
```
- âš ï¸ í†µí•© ì‹œ ê°™ì€ íŒŒì¼ ë‚´ì—ì„œ import ë¶ˆí•„ìš”

---

## âœ… í†µí•© ì œì•ˆ

### ì˜µì…˜ 1: ì™„ì „ í†µí•© (ê¶Œì¥)

**êµ¬ì¡°**:
```
app/domain/langgraph/middleware/
â”œâ”€â”€ __init__.py          (exportë§Œ)
â”œâ”€â”€ middleware.py        (ëª¨ë“  Middleware + Factory í†µí•©)
â””â”€â”€ example_usage.py    (ì°¸ê³ ìš©)
```

**ì¥ì **:
- âœ… íŒŒì¼ ìˆ˜ ê°ì†Œ (5ê°œ â†’ 2ê°œ)
- âœ… ê´€ë ¨ ì½”ë“œ ì§‘ì¤‘
- âœ… import ê²½ë¡œ ë‹¨ìˆœí™”
- âœ… ë°°í¬ ì‹œ ê´€ë¦¬ ìš©ì´

**ë‹¨ì **:
- âš ï¸ íŒŒì¼ í¬ê¸° ì¦ê°€ (ì•½ 500ì¤„)
- âš ï¸ ê°œë³„ Middlewareë§Œ í•„ìš”í•œ ê²½ìš° ë¶ˆí¸ (í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” Factoryë§Œ ì‚¬ìš©)

**ì˜ˆìƒ íŒŒì¼ í¬ê¸°**: ì•½ 500ì¤„ (ê´€ë¦¬ ê°€ëŠ¥í•œ í¬ê¸°)

---

### ì˜µì…˜ 2: ë¶€ë¶„ í†µí•©

**êµ¬ì¡°**:
```
app/domain/langgraph/middleware/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ core.py              (Rate Limiting + Retry + Logging)
â”œâ”€â”€ factory.py           (Factory í•¨ìˆ˜)
â””â”€â”€ example_usage.py
```

**ì¥ì **:
- âœ… Middleware í´ë˜ìŠ¤ë§Œ í†µí•©
- âœ… FactoryëŠ” ë³„ë„ ìœ ì§€

**ë‹¨ì **:
- âš ï¸ ì—¬ì „íˆ 2ê°œ íŒŒì¼ë¡œ ë¶„ë¦¬
- âš ï¸ í†µí•© íš¨ê³¼ ì œí•œì 

---

## ğŸ“Š ë¹„êµí‘œ

| í•­ëª© | í˜„ì¬ êµ¬ì¡° | ì™„ì „ í†µí•© | ë¶€ë¶„ í†µí•© |
|------|----------|----------|----------|
| **íŒŒì¼ ìˆ˜** | 5ê°œ | 2ê°œ | 3ê°œ |
| **ìµœëŒ€ íŒŒì¼ í¬ê¸°** | 153ì¤„ | 500ì¤„ | 400ì¤„ |
| **ê´€ë¦¬ ìš©ì´ì„±** | ì¤‘ê°„ | ë†’ìŒ | ì¤‘ê°„ |
| **ê°œë³„ ì‚¬ìš©** | ì‰¬ì›€ | ê°€ëŠ¥ (export) | ê°€ëŠ¥ (export) |
| **ë°°í¬ ì‹œ** | ë³µì¡ | ê°„ë‹¨ | ì¤‘ê°„ |

---

## ğŸ¯ ê¶Œì¥ ì‚¬í•­

### ê°œë°œ ë‹¨ê³„: í˜„ì¬ êµ¬ì¡° ìœ ì§€ âœ…

**ì´ìœ **:
- âœ… ì½”ë“œ ê°€ë…ì„± ìš°ìˆ˜
- âœ… ê° Middleware ë…ë¦½ì  ê´€ë¦¬
- âœ… ë””ë²„ê¹… ìš©ì´
- âœ… íŒŒì¼ í¬ê¸° ì ì ˆ (ê° 150ì¤„ ë‚´ì™¸)

### ë°°í¬ ë‹¨ê³„: ì™„ì „ í†µí•© ê³ ë ¤ âœ…

**ì´ìœ **:
- âœ… íŒŒì¼ ìˆ˜ ê°ì†Œ (5ê°œ â†’ 2ê°œ)
- âœ… ë°°í¬ ì‹œ ê´€ë¦¬ ìš©ì´
- âœ… import ê²½ë¡œ ë‹¨ìˆœí™”
- âœ… 500ì¤„ì€ ê´€ë¦¬ ê°€ëŠ¥í•œ í¬ê¸°

---

## ğŸ’¡ í†µí•© ì‹œ ê³ ë ¤ì‚¬í•­

### 1. Import ê²½ë¡œ ìœ ì§€

**í†µí•© í›„ì—ë„ ë™ì¼í•œ import ê²½ë¡œ ì‚¬ìš© ê°€ëŠ¥**:

```python
# í†µí•© ì „
from app.domain.langgraph.middleware import wrap_chain_with_middleware

# í†µí•© í›„ (ë™ì¼)
from app.domain.langgraph.middleware import wrap_chain_with_middleware
```

**ì´ìœ **: `__init__.py`ì—ì„œ exportí•˜ë¯€ë¡œ ê²½ë¡œ ë³€ê²½ ë¶ˆí•„ìš”

### 2. í…ŒìŠ¤íŠ¸ ì½”ë“œ ì˜í–¥

**í˜„ì¬**:
```python
from app.domain.langgraph.middleware import (
    RateLimitingMiddleware,
    RetryMiddleware,
    LoggingMiddleware
)
```

**í†µí•© í›„ (ë³€ê²½ ì—†ìŒ)**:
```python
# ë™ì¼í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥ (__init__.pyì—ì„œ export)
from app.domain.langgraph.middleware import (
    RateLimitingMiddleware,
    RetryMiddleware,
    LoggingMiddleware
)
```

### 3. íŒŒì¼ êµ¬ì¡°

**í†µí•© í›„ êµ¬ì¡°**:
```python
# middleware.py
"""
Middleware ëª¨ë“ˆ
Rate Limiting, Retry, Logging Middleware ë° Factory í•¨ìˆ˜
"""

# ===== Rate Limiting Middleware =====
class RateLimitingMiddleware:
    # ... (135ì¤„)

# ===== Retry Middleware =====
class RetryMiddleware:
    # ... (153ì¤„)

# ===== Logging Middleware =====
class LoggingMiddleware:
    # ... (144ì¤„)

# ===== Factory Functions =====
def create_middleware_stack():
    # ... (66ì¤„)

def wrap_chain_with_middleware():
    # ... (66ì¤„)
```

---

## ğŸ”„ í†µí•© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì§€ê¸ˆ í†µí•©

**ì¥ì **:
- âœ… ì¦‰ì‹œ íŒŒì¼ ìˆ˜ ê°ì†Œ
- âœ… ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

**ë‹¨ì **:
- âš ï¸ ê°œë°œ ì¤‘ ê°€ë…ì„± ì €í•˜ ê°€ëŠ¥
- âš ï¸ íŒŒì¼ í¬ê¸° ì¦ê°€

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë°°í¬ ì‹œ í†µí•© (ê¶Œì¥)

**ì¥ì **:
- âœ… ê°œë°œ ì¤‘ ê°€ë…ì„± ìœ ì§€
- âœ… ë°°í¬ ì‹œ ìµœì í™”

**ë‹¨ì **:
- âš ï¸ ë‚˜ì¤‘ì— í†µí•© ì‘ì—… í•„ìš”

---

## âœ… ìµœì¢… ê¶Œì¥ ì‚¬í•­

### í˜„ì¬: êµ¬ì¡° ìœ ì§€ âœ…

**ì´ìœ **:
1. **ê°€ë…ì„±**: ê° Middlewareê°€ ë…ë¦½ íŒŒì¼ë¡œ ê´€ë¦¬ ìš©ì´
2. **ê°œë°œ í¸ì˜ì„±**: íŠ¹ì • Middlewareë§Œ ìˆ˜ì • ì‹œ í•´ë‹¹ íŒŒì¼ë§Œ ì—´ë©´ ë¨
3. **íŒŒì¼ í¬ê¸°**: ê° 150ì¤„ ë‚´ì™¸ë¡œ ì ì ˆ

### ë°°í¬ ì‹œ: ì™„ì „ í†µí•© ê³ ë ¤ âœ…

**ì´ìœ **:
1. **íŒŒì¼ ìˆ˜ ê°ì†Œ**: 5ê°œ â†’ 2ê°œ
2. **ê´€ë¦¬ ìš©ì´**: ë°°í¬ ì‹œ íŒŒì¼ ìˆ˜ ìµœì†Œí™”
3. **í¬ê¸° ì ì ˆ**: 500ì¤„ì€ ê´€ë¦¬ ê°€ëŠ¥í•œ í¬ê¸°

---

## ğŸ“ í†µí•© ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í†µí•© ì „
- [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
- [ ] Import ê²½ë¡œ í™•ì¸
- [ ] ì‚¬ìš©ì²˜ í™•ì¸

### í†µí•© ì‘ì—…
- [ ] `middleware.py` ìƒì„± (ëª¨ë“  í´ë˜ìŠ¤ í†µí•©)
- [ ] `__init__.py` ì—…ë°ì´íŠ¸ (export ê²½ë¡œ ë³€ê²½)
- [ ] `factory.py` ì‚­ì œ (middleware.pyì— í†µí•©)
- [ ] ê°œë³„ íŒŒì¼ ì‚­ì œ (rate_limiting.py, retry.py, logging.py)

### í†µí•© í›„
- [ ] Import í…ŒìŠ¤íŠ¸
- [ ] ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## ğŸ¯ ê²°ë¡ 

### í˜„ì¬ ë‹¨ê³„: êµ¬ì¡° ìœ ì§€ ê¶Œì¥ âœ…

**ì´ìœ **:
- ê°œë°œ ì¤‘ ê°€ë…ì„±ê³¼ ê´€ë¦¬ ìš©ì´ì„±
- ê° Middleware ë…ë¦½ì  ê´€ë¦¬
- íŒŒì¼ í¬ê¸° ì ì ˆ

### ë°°í¬ ë‹¨ê³„: í†µí•© ê³ ë ¤ âœ…

**ì´ìœ **:
- íŒŒì¼ ìˆ˜ ê°ì†Œ
- ë°°í¬ ì‹œ ê´€ë¦¬ ìš©ì´
- 500ì¤„ì€ ê´€ë¦¬ ê°€ëŠ¥í•œ í¬ê¸°

**ê¶Œì¥ ì‹œì **: ë°°í¬ ì§ì „ ë˜ëŠ” ì•ˆì •í™” ë‹¨ê³„




