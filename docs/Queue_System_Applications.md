# í ì‹œìŠ¤í…œ ì ìš© ê°€ëŠ¥ ì˜ì—­

## ğŸ“‹ ê°œìš”

í ì‹œìŠ¤í…œì€ **Judge0 ì½”ë“œ ì‹¤í–‰** ì™¸ì—ë„ ì—¬ëŸ¬ ì˜ì—­ì— ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì˜ì—­ë“¤ì´ í ì‹œìŠ¤í…œì˜ í˜œíƒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ ì ìš© ê°€ëŠ¥í•œ ì˜ì—­

### 1. âœ… Judge0 ì½”ë“œ ì‹¤í–‰ (ì´ë¯¸ ê³„íšë¨)

**í˜„ì¬ ìƒíƒœ**: TODO ì£¼ì„ë§Œ ìˆìŒ
```python
# app/domain/langgraph/nodes/holistic_evaluator/performance.py
# TODO: Judge0 API ì—°ë™
```

**ì ìš© ì´ìœ **:
- ì½”ë“œ ì‹¤í–‰ì€ 5-10ì´ˆ ì†Œìš” (ë¸”ë¡œí‚¹)
- Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ì€ ë¦¬ì†ŒìŠ¤ ì§‘ì•½ì 
- ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰ ì‹œ ì‹œê°„ ì¦ê°€

**í ì‹œìŠ¤í…œ ì ìš©**:
- âœ… ì‘ì—… ì¶”ê°€ â†’ ì¦‰ì‹œ ì‘ë‹µ
- âœ… Workerê°€ ë³„ë„ë¡œ ì‹¤í–‰
- âœ… ê²°ê³¼ë¥¼ Redisì— ì €ì¥

---

### 2. ğŸ”„ Eval Turn SubGraph (ë°±ê·¸ë¼ìš´ë“œ í‰ê°€)

**í˜„ì¬ ìƒíƒœ**: `asyncio.create_task()`ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
```python
# app/application/services/eval_service.py
asyncio.create_task(self._run_eval_turn_background(session_id, result))
```

**í˜„ì¬ ë¬¸ì œì **:
- âŒ API ì„œë²„ í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œ ì‹¤í–‰ (ë©”ëª¨ë¦¬ ê³µìœ )
- âŒ API ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—… ì†ì‹¤
- âŒ Worker í™•ì¥ ë¶ˆê°€ (API ì„œë²„ì™€ ë™ì¼ í”„ë¡œì„¸ìŠ¤)
- âŒ ì—ëŸ¬ ë°œìƒ ì‹œ API ì„œë²„ì— ì˜í–¥ ê°€ëŠ¥

**í ì‹œìŠ¤í…œ ì ìš© í›„**:
```python
# 1. í‰ê°€ ì‘ì—…ì„ íì— ì¶”ê°€
eval_task = EvalTurnTask(
    session_id=session_id,
    turn=current_turn,
    human_message=human_message,
    ai_message=ai_message,
    problem_context=problem_context
)
task_id = await eval_queue.enqueue(eval_task)

# 2. ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜
return {"task_id": task_id, "status": "pending"}

# 3. ë³„ë„ Workerê°€ í‰ê°€ ì‹¤í–‰
# app/application/workers/eval_worker.py
while True:
    task = await eval_queue.dequeue()
    result = await run_eval_turn_subgraph(task)
    await eval_queue.save_result(task.task_id, result)
```

**ì¥ì **:
- âœ… API ì„œë²„ì™€ ì™„ì „ ë¶„ë¦¬
- âœ… Worker ì—¬ëŸ¬ ê°œ ì‹¤í–‰ ê°€ëŠ¥ (í™•ì¥ì„±)
- âœ… API ì„œë²„ ì¬ì‹œì‘í•´ë„ ì‘ì—… ìœ ì§€
- âœ… ì—ëŸ¬ ê²©ë¦¬

---

### 3. ğŸ’¾ ëŒ€í™” ì €ì¥ (PostgreSQL)

**í˜„ì¬ ìƒíƒœ**: ë™ê¸°ì ìœ¼ë¡œ ì €ì¥ (ë˜ëŠ” ì €ì¥ ì•ˆ í•¨)
```python
# app/infrastructure/repositories/session_repository.py
async def add_message(...):
    # PostgreSQLì— ì§ì ‘ ì €ì¥
    self.db.add(message)
    await self.db.flush()
```

**í˜„ì¬ ë¬¸ì œì **:
- âŒ DB ì—°ê²° ì§€ì—° ì‹œ API ì‘ë‹µ ì§€ì—°
- âŒ DB ë¶€í•˜ ì‹œ API ì„œë²„ ì˜í–¥
- âŒ ëŒ€ëŸ‰ ì €ì¥ ì‹œ ì„±ëŠ¥ ì €í•˜

**í ì‹œìŠ¤í…œ ì ìš© í›„**:
```python
# 1. ì €ì¥ ì‘ì—…ì„ íì— ì¶”ê°€
save_task = SaveMessageTask(
    session_id=session_id,
    turn=turn,
    role=role,
    content=content,
    token_count=token_count
)
await storage_queue.enqueue(save_task)

# 2. ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜
return {"status": "saved"}

# 3. ë³„ë„ Workerê°€ DB ì €ì¥
# app/application/workers/storage_worker.py
while True:
    task = await storage_queue.dequeue()
    await session_repo.add_message(
        session_id=task.session_id,
        turn=task.turn,
        role=task.role,
        content=task.content
    )
```

**ì¥ì **:
- âœ… API ì‘ë‹µ ì†ë„ í–¥ìƒ
- âœ… DB ë¶€í•˜ ë¶„ì‚°
- âœ… ë°°ì¹˜ ì €ì¥ ê°€ëŠ¥ (ì„±ëŠ¥ í–¥ìƒ)

---

### 4. ğŸ“¤ Spring Boot ì½œë°± ì „ì†¡

**í˜„ì¬ ìƒíƒœ**: ë™ê¸°ì ìœ¼ë¡œ HTTP ìš”ì²­
```python
# app/application/services/callback_service.py
async def send_final_scores(...):
    payload = {...}
    return await self._send_callback(payload)  # HTTP ìš”ì²­
```

**í˜„ì¬ ë¬¸ì œì **:
- âŒ ì™¸ë¶€ ì„œë²„ ì‘ë‹µ ì§€ì—° ì‹œ API ë¸”ë¡œí‚¹
- âŒ ì™¸ë¶€ ì„œë²„ ë‹¤ìš´ ì‹œ ì—ëŸ¬ ì „íŒŒ
- âŒ ì¬ì‹œë„ ë¡œì§ ë³µì¡

**í ì‹œìŠ¤í…œ ì ìš© í›„**:
```python
# 1. ì½œë°± ì‘ì—…ì„ íì— ì¶”ê°€
callback_task = CallbackTask(
    type="final_scores",
    session_id=session_id,
    payload=payload
)
await callback_queue.enqueue(callback_task)

# 2. ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜
return {"status": "queued"}

# 3. ë³„ë„ Workerê°€ ì½œë°± ì „ì†¡ (ì¬ì‹œë„ í¬í•¨)
# app/application/workers/callback_worker.py
while True:
    task = await callback_queue.dequeue()
    for attempt in range(3):  # ìµœëŒ€ 3íšŒ ì¬ì‹œë„
        try:
            await send_http_callback(task.payload)
            break
        except Exception as e:
            if attempt == 2:
                await dead_letter_queue.enqueue(task)  # ì‹¤íŒ¨ ì‹œ DLQ
```

**ì¥ì **:
- âœ… ì™¸ë¶€ ì„œë²„ ì¥ì•  ì‹œì—ë„ API ì•ˆì •ì„±
- âœ… ìë™ ì¬ì‹œë„
- âœ… Dead Letter Queueë¡œ ì‹¤íŒ¨ ì‘ì—… ì¶”ì 

---

### 5. ğŸ“Š ì„±ëŠ¥ ì§‘ê³„ (níšŒ ì‹¤í–‰)

**í˜„ì¬ ìƒíƒœ**: ê³„íš ë‹¨ê³„
```python
# app/domain/performance/aggregator.py (ê³„íšë¨)
# níšŒ ì‹¤í–‰í•˜ì—¬ ì¤‘ì•™ê°’ ê³„ì‚°
```

**í ì‹œìŠ¤í…œ ì ìš©**:
```python
# 1. ì„±ëŠ¥ ì¸¡ì • ì‘ì—…ì„ íì— ì¶”ê°€
perf_task = PerformanceTask(
    code=code,
    language=language,
    test_cases=test_cases,
    runs=5  # 5íšŒ ì‹¤í–‰
)
task_id = await perf_queue.enqueue(perf_task)

# 2. Workerê°€ níšŒ ì‹¤í–‰
# app/application/workers/performance_worker.py
while True:
    task = await perf_queue.dequeue()
    results = []
    for i in range(task.runs):
        result = await execute_code(task)
        results.append(result)
    
    # ì§‘ê³„
    aggregated = aggregate_metrics(results)
    await perf_queue.save_result(task.task_id, aggregated)
```

**ì¥ì **:
- âœ… níšŒ ì‹¤í–‰ì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬ ê°€ëŠ¥
- âœ… ê° ì‹¤í–‰ì´ ë…ë¦½ì  (ì—ëŸ¬ ê²©ë¦¬)
- âœ… Worker í™•ì¥ìœ¼ë¡œ ì†ë„ í–¥ìƒ

---

### 6. ğŸ” LLM í˜¸ì¶œ (ì„ íƒì )

**í˜„ì¬ ìƒíƒœ**: ë™ê¸°ì ìœ¼ë¡œ í˜¸ì¶œ
```python
# app/domain/langgraph/nodes/intent_analyzer.py
result = await llm.ainvoke(messages)
```

**ì£¼ì˜**: LLM í˜¸ì¶œì€ **ì¼ë°˜ì ìœ¼ë¡œ í ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ**
- ì‘ë‹µì´ ì¦‰ì‹œ í•„ìš”í•¨ (ë‹¤ìŒ ë…¸ë“œë¡œ ì§„í–‰)
- ìŠ¤íŠ¸ë¦¬ë° ì§€ì› í•„ìš”
- ìƒíƒœ ê´€ë¦¬ ë³µì¡

**í•˜ì§€ë§Œ íŠ¹ì • ê²½ìš°ì—ëŠ” ì ìš© ê°€ëŠ¥**:
- ë°°ì¹˜ ì²˜ë¦¬ (ëŒ€ëŸ‰ LLM í˜¸ì¶œ)
- ë¹„ì‹¤ì‹œê°„ ë¶„ì„
- ë¦¬í¬íŠ¸ ìƒì„±

---

## ğŸ“Š í ì‹œìŠ¤í…œ ì ìš© ìš°ì„ ìˆœìœ„

### ğŸ”´ High Priority (ì¦‰ì‹œ ì ìš© ê¶Œì¥)

1. **Judge0 ì½”ë“œ ì‹¤í–‰** â­
   - ì´ìœ : ì‹¤í–‰ ì‹œê°„ì´ ê¸¸ê³  (5-10ì´ˆ), ë¦¬ì†ŒìŠ¤ ì§‘ì•½ì 
   - ì˜í–¥: API ì‘ë‹µ ì†ë„ í–¥ìƒ

2. **Eval Turn SubGraph** â­
   - ì´ìœ : í˜„ì¬ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ì´ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ ë‚´ë¶€
   - ì˜í–¥: í™•ì¥ì„±, ì•ˆì •ì„± í–¥ìƒ

### ğŸŸ¡ Medium Priority (ì ì§„ì  ì ìš©)

3. **ëŒ€í™” ì €ì¥ (PostgreSQL)**
   - ì´ìœ : DB ë¶€í•˜ ë¶„ì‚°, API ì‘ë‹µ ì†ë„ í–¥ìƒ
   - ì˜í–¥: ëŒ€ëŸ‰ ìš”ì²­ ì‹œ íš¨ê³¼ì 

4. **Spring Boot ì½œë°±**
   - ì´ìœ : ì™¸ë¶€ ì„œë²„ ì˜ì¡´ì„± ì œê±°
   - ì˜í–¥: ì•ˆì •ì„± í–¥ìƒ

### ğŸŸ¢ Low Priority (ì„ íƒì )

5. **ì„±ëŠ¥ ì§‘ê³„**
   - ì´ìœ : níšŒ ì‹¤í–‰ì„ ë³‘ë ¬ ì²˜ë¦¬
   - ì˜í–¥: ì„±ëŠ¥ ì¸¡ì • ì†ë„ í–¥ìƒ

6. **LLM í˜¸ì¶œ**
   - ì´ìœ : íŠ¹ìˆ˜í•œ ê²½ìš°ì—ë§Œ í•„ìš”
   - ì˜í–¥: ë°°ì¹˜ ì²˜ë¦¬ ì‹œì—ë§Œ íš¨ê³¼ì 

---

## ğŸ—ï¸ í ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì—¬ëŸ¬ íë¥¼ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API ì„œë²„                              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Judge Queue  â”‚  â”‚ Eval Queue   â”‚  â”‚ Storage Queueâ”‚ â”‚
â”‚  â”‚   (ì½”ë“œ ì‹¤í–‰) â”‚  â”‚  (í‰ê°€)      â”‚  â”‚  (DB ì €ì¥)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redis                                â”‚
â”‚                                                         â”‚
â”‚  judge_queue:pending                                    â”‚
â”‚  eval_queue:pending                                     â”‚
â”‚  storage_queue:pending                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                    â†“                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Worker í”„ë¡œì„¸ìŠ¤ë“¤                          â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Judge Worker  â”‚  â”‚Eval Worker   â”‚  â”‚Storage Workerâ”‚ â”‚
â”‚  â”‚  (ì½”ë“œ ì‹¤í–‰)  â”‚  â”‚  (í‰ê°€)      â”‚  â”‚  (DB ì €ì¥)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íë³„ íŠ¹ì„±

| í ì´ë¦„ | ìš°ì„ ìˆœìœ„ | ì²˜ë¦¬ ì‹œê°„ | Worker ìˆ˜ | ì¬ì‹œë„ |
|--------|---------|----------|----------|--------|
| Judge Queue | High | 5-10ì´ˆ | 3-5ê°œ | í•„ìš” ì—†ìŒ |
| Eval Queue | High | 5-10ì´ˆ | 2-3ê°œ | í•„ìš” ì—†ìŒ |
| Storage Queue | Medium | 0.1-0.5ì´ˆ | 1-2ê°œ | í•„ìš” |
| Callback Queue | Medium | 0.5-2ì´ˆ | 1ê°œ | í•„ìš” (3íšŒ) |

---

## ğŸ’¡ êµ¬í˜„ ì „ëµ

### Phase 1: Judge0 í ì‹œìŠ¤í…œ (1ì£¼)
- Judge Queue êµ¬í˜„
- Judge Worker êµ¬í˜„
- ê¸°ì¡´ ì½”ë“œ í†µí•©

### Phase 2: Eval Turn í ì‹œìŠ¤í…œ (1ì£¼)
- Eval Queue êµ¬í˜„
- Eval Worker êµ¬í˜„
- ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ë¥¼ íë¡œ ì „í™˜

### Phase 3: Storage & Callback í (1ì£¼)
- Storage Queue êµ¬í˜„
- Callback Queue êµ¬í˜„
- ê°ê° Worker êµ¬í˜„

---

## ğŸ“ ìš”ì•½

**í ì‹œìŠ¤í…œì€ Judge0 ì™¸ì—ë„ ì ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤:**

1. âœ… **Eval Turn SubGraph**: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ë¥¼ íë¡œ ì „í™˜
2. âœ… **ëŒ€í™” ì €ì¥**: PostgreSQL ì €ì¥ì„ ë¹„ë™ê¸°í™”
3. âœ… **ì½œë°± ì „ì†¡**: Spring Boot ì½œë°±ì„ íë¡œ ì²˜ë¦¬
4. âœ… **ì„±ëŠ¥ ì§‘ê³„**: níšŒ ì‹¤í–‰ì„ ë³‘ë ¬ ì²˜ë¦¬
5. âš ï¸ **LLM í˜¸ì¶œ**: íŠ¹ìˆ˜í•œ ê²½ìš°ì—ë§Œ ì ìš©

**ìš°ì„ ìˆœìœ„**:
- ğŸ”´ High: Judge0, Eval Turn
- ğŸŸ¡ Medium: Storage, Callback
- ğŸŸ¢ Low: Performance, LLM

**í•µì‹¬ ì´ì **:
- API ì„œë²„ ì‘ë‹µ ì†ë„ í–¥ìƒ
- í™•ì¥ì„± (Worker ì—¬ëŸ¬ ê°œ)
- ì•ˆì •ì„± (ì—ëŸ¬ ê²©ë¦¬)
- ë¶€í•˜ ë¶„ì‚°

