# 의도별 평가 기준 개선 가이드

## 📋 개요

모든 평가 항목을 필수로 평가하는 것이 아니라, 의도에 맞는 필수/선택 평가 항목을 구분하여 평가하도록 개선했습니다.

---

## ✅ 구현 완료 사항

### 문제점
- 기존: 모든 의도에 대해 5가지 항목(명확성, 문제 적절성, 예시, 규칙, 문맥)을 모두 필수로 평가
- 문제: "DP에 대해 알려줘" 같은 단순한 질문도 유효한 접근인데, 모든 항목을 평가하여 낮은 점수를 받음
- 사용자 의도: 의도를 명확히 하는 것이 중요하고, 문제에 접근하기 위해 돌아가서 자신의 지식을 확실히 하는 것도 유효한 전략

### 해결 방안
- 의도별로 필수 평가 항목과 선택 평가 항목을 구분
- 필수 항목 중심으로 점수 계산
- 선택 항목은 보너스 점수로만 고려

---

## 🎯 의도별 평가 기준

### 1. 힌트/질의 요청 (Hint/Query)
**필수 항목**:
- 명확성 (Clarity)
- 문제 적절성 (Problem Relevance)

**선택 항목**:
- 예시 (Examples)
- 규칙 (Rules)
- 문맥 (Context)

**설명**: 의도를 명확히 전달하고 문제와 관련된 질문을 하는 것이 중요합니다. 예시나 규칙은 선택적이며, 단순히 개념을 물어보는 것도 유효한 접근입니다.

**예시**:
- ✅ "DP에 대해 알려줘" → 명확성(90점), 문제 적절성(80점) → 최종 85점
- ✅ "DP에 대해 알려줘" + 예시 제공 → 필수 항목 평균 85점 + 보너스 5점 → 최종 90점

---

### 2. 코드 생성 요청 (Generation)
**필수 항목**:
- 명확성 (Clarity)
- 예시 (Examples)
- 문제 적절성 (Problem Relevance)

**선택 항목**:
- 규칙 (Rules)
- 문맥 (Context)

**설명**: 입출력 예시와 구현 조건이 필수입니다. 규칙(제약조건)은 선택적입니다.

---

### 3. 최적화 요청 (Optimization)
**필수 항목**:
- 명확성 (Clarity)
- 문제 적절성 (Problem Relevance)
- 규칙 (Rules)

**선택 항목**:
- 예시 (Examples)
- 문맥 (Context)

**설명**: 현재 코드의 문제점과 목표 성능을 명시하는 것이 필수입니다.

---

### 4. 디버깅 요청 (Debugging)
**필수 항목**:
- 명확성 (Clarity)
- 문제 적절성 (Problem Relevance)

**선택 항목**:
- 예시 (Examples)
- 규칙 (Rules)
- 문맥 (Context)

**설명**: 에러 메시지나 재현 단계를 명확히 설명하는 것이 중요합니다.

---

### 5. 테스트 케이스 요청 (Test Case)
**필수 항목**:
- 명확성 (Clarity)
- 예시 (Examples)

**선택 항목**:
- 문제 적절성 (Problem Relevance)
- 규칙 (Rules)
- 문맥 (Context)

**설명**: 테스트하고 싶은 엣지 케이스나 경계 조건을 명시하는 것이 필수입니다.

---

### 6. 후속 질문 (Follow Up)
**필수 항목**:
- 명확성 (Clarity)
- 문맥 (Context)

**선택 항목**:
- 문제 적절성 (Problem Relevance)
- 예시 (Examples)
- 규칙 (Rules)

**설명**: 이전 턴의 답변을 기반으로 논리적으로 연결하는 것이 중요합니다.

---

### 7. 규칙 설정 (Rule Setting)
**필수 항목**:
- 명확성 (Clarity)
- 규칙 (Rules)

**선택 항목**:
- 문제 적절성 (Problem Relevance)
- 예시 (Examples)
- 문맥 (Context)

**설명**: 제약조건을 명확히 명시하는 것이 필수입니다.

---

## 🔧 점수 계산 방식

### 기본 원칙
1. **필수 항목 중심 평가**: 필수 항목이 잘 충족되면 높은 점수를 부여
2. **선택 항목은 보너스**: 선택 항목은 평가하지 않아도 되며, 평가하더라도 보너스 점수로만 고려
3. **단순 질문도 유효**: 모든 항목을 다 써야 좋은 프롬프트가 아님
4. **문제 접근 방식 다양성**: 사용자가 문제에 접근하기 위해 돌아가서 자신의 지식을 확실히 하는 것도 유효한 전략

### 점수 계산 공식
```
기본 점수 = 필수 항목 점수의 평균 (80-90%)
보너스 점수 = 선택 항목 점수의 평균 * 0.2 (10-20%)
최종 점수 = 기본 점수 + 보너스 점수
```

### 예시
- **"DP에 대해 알려줘"** (HINT_OR_QUERY)
  - 필수 항목: 명확성(90점), 문제 적절성(80점)
  - 기본 점수: (90 + 80) / 2 = 85점
  - 선택 항목: 없음
  - 최종 점수: 85점 ✅

- **"DP에 대해 알려줘" + 예시 제공** (HINT_OR_QUERY)
  - 필수 항목: 명확성(90점), 문제 적절성(80점)
  - 기본 점수: (90 + 80) / 2 = 85점
  - 선택 항목: 예시(90점)
  - 보너스 점수: 90 * 0.2 = 18점 (최대 20점 제한)
  - 최종 점수: 85 + 18 = 90점 ✅

---

## 📝 프롬프트 개선 사항

### 변경 전
```
평가 기준 (Claude Prompt Engineering):
1. 명확성 (Clarity)
2. 문제 적절성 (Problem Relevance)
3. 예시 (Examples)
4. 규칙 (Rules)
5. 문맥 (Context)

위 기준을 바탕으로 0-100점 사이의 점수를 부여하세요.
```

### 변경 후
```
**필수 평가 항목 (Required):**
- 명확성 (Clarity)
- 문제 적절성 (Problem Relevance)

**선택 평가 항목 (Optional - 보너스):**
- 예시 (Examples)
- 규칙 (Rules)
- 문맥 (Context)

**중요 평가 원칙**: 
1. 필수 항목 중심 평가: 필수 항목이 잘 충족되면 높은 점수를 부여하세요.
2. 선택 항목은 보너스: 선택 항목은 평가하지 않아도 되며, 평가하더라도 보너스 점수로만 고려하세요.
3. 단순 질문도 유효: 예를 들어, 단순히 "DP에 대해 알려줘" 같은 질문도 의도가 명확하고 문제와 관련이 있다면 유효한 접근입니다.
4. 문제 접근 방식 다양성: 사용자가 문제에 접근하기 위해 돌아가서 자신의 지식을 확실히 하는 것도 유효한 전략입니다.

**평가 방법**:
1. 필수 항목 평가: 필수 항목은 반드시 평가하고 점수를 부여하세요.
2. 선택 항목 평가: 선택 항목은 평가하지 않아도 됩니다. 평가하더라도 점수에 큰 영향을 주지 않도록 하세요.
3. 점수 계산: 필수 항목 점수의 평균을 기본 점수(80-90%)로 계산하세요. 선택 항목이 있으면 보너스 점수(10-20%)로만 추가하세요.
4. rubrics 작성: 필수 항목은 반드시 포함하세요. 선택 항목은 평가하지 않았으면 포함하지 않아도 됩니다.
```

---

## 🔗 관련 파일

- `app/domain/langgraph/nodes/turn_evaluator/evaluators.py`
  - `get_intent_specific_criteria()`: 의도별 평가 기준 정의
  - `prepare_evaluation_input_internal()`: 평가 입력 준비 (필수/선택 항목 구분)

---

## 📊 평가 결과 예시

### Before (기존 방식)
```json
{
  "score": 4,
  "rubrics": [
    {"criterion": "명확성", "score": 10},
    {"criterion": "문제 적절성", "score": 10},
    {"criterion": "예시", "score": 0},
    {"criterion": "규칙", "score": 0},
    {"criterion": "문맥", "score": 0}
  ]
}
```

### After (개선된 방식)
```json
{
  "score": 85,
  "rubrics": [
    {"criterion": "명확성", "score": 90},
    {"criterion": "문제 적절성", "score": 80}
  ],
  "final_reasoning": "의도가 명확하고 문제와 관련이 있어 유효한 접근입니다."
}
```

---

## 🎯 기대 효과

1. **평가 정확성 향상**: 의도에 맞는 평가 기준 적용
2. **사용자 경험 개선**: 단순 질문도 유효한 접근으로 인정
3. **유연한 평가**: 문제 접근 방식의 다양성 인정
4. **명확한 피드백**: 필수 항목 중심의 명확한 피드백 제공


