================================================================================
                    Change_11_27_graph.txt
                    LangGraph êµ¬ì¡° ë³€ê²½ ë° í…ŒìŠ¤íŠ¸ ê²°ê³¼
                    ì‘ì„±ì¼: 2025-11-27
================================================================================

## ğŸ“‹ ëª©ì°¨
0. ê·¸ë˜í”„ êµ¬ì¡° ë„ì‹í™” (â˜… ì‹ ê·œ)
1. LangGraph êµ¬ì¡° ë³€ê²½ ì‚¬í•­
2. ê° ë…¸ë“œì˜ ì—­í•  ë° ì¶œë ¥ í˜•ì‹
3. ìƒˆë¡œ ì¶”ê°€/ë³€ê²½ëœ íŒŒì¼
4. í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©
5. ë°œê²¬ëœ ë¬¸ì œ ë° ì˜¤ë¥˜
6. ë‹¤ìŒ ë‹¨ê³„

================================================================================
## 0. ê·¸ë˜í”„ êµ¬ì¡° ë„ì‹í™”
================================================================================

### 0.1 ì „ì²´ LangGraph êµ¬ì¡° (Main Graph)

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚         START                   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  1. Handle Request               â”‚
                              â”‚  - ì„¸ì…˜ ë¡œë“œ                     â”‚
                              â”‚  - í„´ ë²ˆí˜¸ ì¦ê°€                  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  2. Intent Analyzer              â”‚
                              â”‚  - ì˜ë„ ë¶„ì„                     â”‚
                              â”‚  - ê°€ë“œë ˆì¼ ì²´í¬                 â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                                  â”‚
            [ì¼ë°˜ ì±„íŒ…]                                         [ì œì¶œ ìš”ì²­]
                    â”‚                                                  â”‚
                    â–¼                                                  â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  3. Writer LLM           â”‚                  â”‚  4G. Eval Turn Guard         â”‚
     â”‚  - AI ë‹µë³€ ìƒì„±          â”‚                  â”‚  - ëˆ„ë½ í„´ í™•ì¸              â”‚
     â”‚  - messages ë°°ì—´ ì¶”ê°€    â”‚                  â”‚  - Redis turn_logs ì¡°íšŒ      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  - ëˆ„ë½ í„´ ì¬í‰ê°€            â”‚
                â”‚                                   â”‚  - turn_scores ë³€í™˜          â”‚
                â”‚ [SUCCESS]                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                              â”‚
                â–¼                                              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚         END              â”‚                  â”‚  5. Main Router              â”‚
     â”‚  (ì‘ë‹µ ë°˜í™˜)             â”‚                  â”‚  - ì œì¶œ í™•ì¸                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                              â”‚
                â”‚                                              â–¼
                â”‚ [ë°±ê·¸ë¼ìš´ë“œ]                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ ë¹„ë™ê¸° ì‹¤í–‰                      â”‚  6a. Eval Holistic Flow      â”‚
                â”‚                                   â”‚  - Chaining í‰ê°€             â”‚
                â–¼                                   â”‚  - Redis turn_logs í™œìš©      â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚  4. Eval Turn SubGraph   â”‚                             â”‚
     â”‚  (ë°±ê·¸ë¼ìš´ë“œ)            â”‚                             â–¼
     â”‚  - ì˜ë„ ë¶„ì„             â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  - í”„ë¡¬í”„íŠ¸ í‰ê°€         â”‚                  â”‚  6b. Aggregate Turn Scores   â”‚
     â”‚  - Redis ì €ì¥            â”‚                  â”‚  - turn_scores ì§‘ê³„          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚                     â”‚
                                                    â–¼                     â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  6c. Code Performance â”‚  â”‚ 6d. Code Correctness â”‚
                                    â”‚  - ì„±ëŠ¥ í‰ê°€          â”‚  â”‚ - ì •í™•ì„± í‰ê°€        â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚                          â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚ 7. Aggregate Final Score â”‚
                                                â”‚ - ìµœì¢… ì§‘ê³„              â”‚
                                                â”‚ - ë“±ê¸‰ ì‚°ì •              â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                â”‚         END              â”‚
                                                â”‚  (í‰ê°€ ê²°ê³¼ ë°˜í™˜)       â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 0.2 í”Œë¡œìš° ë¹„êµ: ì¼ë°˜ ì±„íŒ… vs ì œì¶œ

#### ì¼ë°˜ ì±„íŒ… í”Œë¡œìš°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â”‚â”€â”€â”€â–¶â”‚ Intent  â”‚â”€â”€â”€â–¶â”‚ Writer  â”‚â”€â”€â”€â–¶â”‚   END   â”‚
â”‚    1    â”‚    â”‚    2    â”‚    â”‚    3    â”‚    â”‚ (ì‘ë‹µ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Eval Turn  â”‚
                              â”‚   SubGraph  â”‚
                              â”‚     (4)     â”‚
                              â”‚             â”‚
                              â”‚ Redis ì €ì¥  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì œì¶œ í”Œë¡œìš°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request â”‚â”€â”€â”€â–¶â”‚ Intent  â”‚â”€â”€â”€â–¶â”‚  Guard  â”‚â”€â”€â”€â–¶â”‚ Router  â”‚
â”‚    1    â”‚    â”‚    2    â”‚    â”‚   4G    â”‚    â”‚    5    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Holistic â”‚â”€â”€â”€â–¶â”‚Aggregateâ”‚â”€â”€â”€â–¶â”‚  Code   â”‚â”€â”€â”€â–¶â”‚  Code   â”‚
â”‚   6a    â”‚    â”‚  Turn   â”‚    â”‚  Perf   â”‚    â”‚Correct  â”‚
â”‚  Flow   â”‚    â”‚   6b    â”‚    â”‚   6c    â”‚    â”‚   6d    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚Aggregateâ”‚
                                             â”‚  Final  â”‚
                                             â”‚    7    â”‚
                                             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚   END   â”‚
                                             â”‚ (í‰ê°€)  â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 0.3 Eval Turn SubGraph (Node 4) ë‚´ë¶€ êµ¬ì¡°

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  4. Eval Turn SubGraph  â”‚
                         â”‚        START            â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 4.0 Intent Analysis    â”‚
                         â”‚ - í„´ ì˜ë„ 7ê°€ì§€ ë¶„ë¥˜   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚                             â”‚
        â”‚ [generation]    [optimization]    [debugging]    [etc...]â”‚
        â”‚                             â”‚                             â”‚
        â–¼                             â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4.G ì½”ë“œ ìƒì„± â”‚         â”‚ 4.O ìµœì í™” í‰ê°€   â”‚         â”‚ 4.D ë””ë²„ê¹… í‰ê°€  â”‚
â”‚     í‰ê°€      â”‚         â”‚                   â”‚         â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.T í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤     â”‚
              â”‚                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.H íŒíŠ¸/ì§ˆì˜ í‰ê°€    â”‚
              â”‚                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.R ê·œì¹™ ì„¤ì • í‰ê°€    â”‚
              â”‚                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.F í›„ì† ì‘ë‹µ í‰ê°€    â”‚
              â”‚                       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.X Summarize Answer  â”‚
              â”‚ - AI ë‹µë³€ ìš”ì•½        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ 4.4 Aggregate Turn Logâ”‚
              â”‚ - í„´ ì ìˆ˜ ê³„ì‚°        â”‚
              â”‚ - Redis ì €ì¥          â”‚
              â”‚   turn_logs:{sess}:{n}â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   END   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 0.4 ë°ì´í„° íë¦„ (Data Flow)

#### State êµ¬ì¡°
```python
MainGraphState = {
    # ê¸°ë³¸ ì •ë³´
    "session_id": str,
    "exam_id": int,
    "participant_id": int,
    "spec_id": int,
    
    # ë©”ì‹œì§€
    "messages": [
        {"turn": 1, "role": "user", "content": "...", "timestamp": "..."},
        {"turn": 1, "role": "assistant", "content": "...", "timestamp": "..."},
        ...
    ],
    "current_turn": int,
    "human_message": str,
    "ai_message": str,
    
    # ìƒíƒœ
    "intent_status": str,
    "writer_status": str,
    "is_submitted": bool,
    "is_guardrail_failed": bool,
    
    # í‰ê°€ ê²°ê³¼
    "turn_scores": {
        "1": 85.5,
        "2": 92.0,
        "3": 78.3
    },
    "holistic_flow_score": float,
    "aggregate_turn_score": float,
    "code_performance_score": float,
    "code_correctness_score": float,
    "final_scores": {
        "prompt_score": float,
        "performance_score": float,
        "correctness_score": float,
        "total_score": float,
        "grade": str
    },
    
    # ê¸°íƒ€
    "code_content": str,
    "error_message": str,
    ...
}
```

#### Redis ë°ì´í„° êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Redis Key Structure                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  graph_state:{session_id}                               â”‚
â”‚  â”œâ”€ session_id, exam_id, participant_id                 â”‚
â”‚  â”œâ”€ messages: [...]                                     â”‚
â”‚  â”œâ”€ current_turn                                        â”‚
â”‚  â””â”€ turn_scores: {"1": 85.5, "2": 92.0}                â”‚
â”‚                                                          â”‚
â”‚  turn_logs:{session_id}:{turn}                          â”‚
â”‚  â”œâ”€ turn_number                                         â”‚
â”‚  â”œâ”€ user_prompt_summary                                 â”‚
â”‚  â”œâ”€ prompt_evaluation_details                           â”‚
â”‚  â”‚   â”œâ”€ intent                                          â”‚
â”‚  â”‚   â”œâ”€ score                                           â”‚
â”‚  â”‚   â””â”€ rubrics: [...]                                  â”‚
â”‚  â”œâ”€ llm_answer_summary                                  â”‚
â”‚  â”œâ”€ llm_answer_reasoning                                â”‚
â”‚  â””â”€ timestamp                                           â”‚
â”‚                                                          â”‚
â”‚  eval:scores:{session_id}                               â”‚
â”‚  â”œâ”€ turns: {"1": {...}, "2": {...}}                    â”‚
â”‚  â”œâ”€ final: {...}                                        â”‚
â”‚  â””â”€ completed_at                                        â”‚
â”‚                                                          â”‚
â”‚  memory:summary:{session_id}                            â”‚
â”‚  â””â”€ summary, context, updated_at                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 0.5 ë…¸ë“œ ê°„ ë¼ìš°íŒ… ê·œì¹™

```
Intent Analyzer (2)
â”œâ”€ PASSED_HINT â†’ Writer (3)
â”œâ”€ PASSED_SUBMIT â†’ Eval Turn Guard (4G)
â”œâ”€ FAILED_GUARDRAIL â†’ Handle Failure
â””â”€ FAILED_RATE_LIMIT â†’ Handle Request (ì¬ì‹œë„)

Writer (3)
â”œâ”€ SUCCESS (ì¼ë°˜) â†’ END
â”œâ”€ SUCCESS (ì œì¶œ) â†’ Eval Turn (ì‚¬ìš© ì•ˆ í•¨)
â”œâ”€ FAILED_THRESHOLD â†’ Summarize Memory
â””â”€ FAILED_* â†’ Handle Failure

Eval Turn Guard (4G)
â””â”€ í•­ìƒ â†’ Main Router (5)

Main Router (5)
â”œâ”€ is_submitted=True â†’ Eval Holistic Flow (6a)
â””â”€ ê¸°íƒ€ â†’ END

Eval Turn SubGraph (4) - Intent Router
â”œâ”€ generation â†’ 4.G (ì½”ë“œ ìƒì„± í‰ê°€)
â”œâ”€ optimization â†’ 4.O (ìµœì í™” í‰ê°€)
â”œâ”€ debugging â†’ 4.D (ë””ë²„ê¹… í‰ê°€)
â”œâ”€ test_case â†’ 4.T (í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í‰ê°€)
â”œâ”€ hint_query â†’ 4.H (íŒíŠ¸/ì§ˆì˜ í‰ê°€)
â”œâ”€ rule_setting â†’ 4.R (ê·œì¹™ ì„¤ì • í‰ê°€)
â””â”€ follow_up â†’ 4.F (í›„ì† ì‘ë‹µ í‰ê°€)
```

---

### 0.6 íƒ€ì„ë¼ì¸ (Execution Timeline)

#### ì¼ë°˜ ì±„íŒ… ì‹œë‚˜ë¦¬ì˜¤
```
Time    Main Thread                         Background Thread
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms     [1. Handle Request] ì‹œì‘
10ms    [2. Intent Analyzer] ì‹œì‘
500ms   [3. Writer LLM] ì‹œì‘
8000ms  [3. Writer LLM] ì™„ë£Œ
8001ms  END (ì‘ë‹µ ë°˜í™˜) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
8002ms                              â”‚
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                     â”‚
                                     â””â”€â”€â–¶ [4. Eval Turn] ì‹œì‘
                                         [4.0 Intent Analysis]
                                         [4.G/O/D/T... í‰ê°€]
                                         [4.X Summarize]
                                         [4.4 Aggregate]
                                         Redis ì €ì¥ ì™„ë£Œ
                                         (ì•½ 3-5ì´ˆ ì†Œìš”)
```

#### ì œì¶œ ì‹œë‚˜ë¦¬ì˜¤
```
Time    Execution Flow
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0ms     [1. Handle Request]
10ms    [2. Intent Analyzer] - ì œì¶œ ê°ì§€
20ms    [4G. Eval Turn Guard]
        â”œâ”€ Redis turn_logs ì¡°íšŒ
        â”œâ”€ ëˆ„ë½ í„´ ë°œê²¬: [1, 3, 4]
        â”œâ”€ messages ë°°ì—´ ê²€ìƒ‰ (âŒ turn ì •ë³´ ì—†ìŒ)
        â””â”€ turn_scores ë³€í™˜ (ì¼ë¶€ë§Œ ì„±ê³µ)
1000ms  [5. Main Router]
1010ms  [6a. Eval Holistic Flow]
        â”œâ”€ Redis turn_logs ì¡°íšŒ
        â””â”€ Chaining í‰ê°€
6000ms  [6b. Aggregate Turn Scores]
6100ms  [6c. Code Performance]
15000ms [6d. Code Correctness]
25000ms [7. Aggregate Final Scores]
25100ms END (í‰ê°€ ê²°ê³¼ ë°˜í™˜)

ì´ ì†Œìš” ì‹œê°„: ì•½ 25ì´ˆ
```

---

### 0.7 ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Any Node   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    [ì—ëŸ¬ ë°œìƒ]
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   [Guardrail]        [Rate Limit]      [Technical]
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Handle Failure â”‚  â”‚Handle Request â”‚  â”‚Handle       â”‚
â”‚               â”‚  â”‚   (ì¬ì‹œë„)    â”‚  â”‚  Failure    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â”‚                  â”‚ retry < 3        â”‚
        â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
        â”‚                            â–¼        â”‚
        â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     END      â”‚â—€â”€â”€â”˜
                           â”‚ (ì—ëŸ¬ ì‘ë‹µ)  â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

================================================================================
## 1. LangGraph êµ¬ì¡° ë³€ê²½ ì‚¬í•­
================================================================================

### 1.1 ê¸°ì¡´ êµ¬ì¡° (Change_11_25.txt ê¸°ì¤€)
```
ì¼ë°˜ ì±„íŒ…:
  1. Handle Request â†’ 2. Intent Analyzer â†’ 3. Writer LLM â†’ END
  (ë°±ê·¸ë¼ìš´ë“œ: 4ë²ˆ Eval Turn ì‹¤í–‰ - ë¯¸êµ¬í˜„)

ì œì¶œ ìš”ì²­:
  1. Handle Request â†’ 2. Intent Analyzer â†’ 3. Writer LLM â†’ 
  4. Eval Turn SubGraph â†’ 6a-d â†’ 7. Aggregate â†’ END
```

### 1.2 ë³€ê²½ í›„ êµ¬ì¡°
```
ì¼ë°˜ ì±„íŒ…:
  1. Handle Request â†’ 2. Intent Analyzer â†’ 3. Writer LLM â†’ END
  (ë°±ê·¸ë¼ìš´ë“œ: 4ë²ˆ Eval Turn SubGraph ì‹¤í–‰ - êµ¬í˜„ ì™„ë£Œ)

ì œì¶œ ìš”ì²­:
  1. Handle Request â†’ 2. Intent Analyzer â†’ 4G. Eval Turn Guard â†’ 
  5. Main Router â†’ 6a. Holistic Flow â†’ 6b. Aggregate Turn â†’ 
  6c. Code Performance â†’ 6d. Code Correctness â†’ 7. Aggregate Final â†’ END
```

### 1.3 ì£¼ìš” ë³€ê²½ì 
1. **4ë²ˆ ê°€ë“œ ë…¸ë“œ ì¶”ê°€** (`eval_turn_guard`)
   - ì œì¶œ ì‹œ ëª¨ë“  í„´ì˜ í‰ê°€ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
   - ëˆ„ë½ëœ í„´ ì¬í‰ê°€ (messages ë°°ì—´ì—ì„œ ë³µì›)
   - Redis turn_logsë¥¼ state turn_scoresë¡œ ë³€í™˜

2. **ì œì¶œ í”Œë¡œìš° ë¼ìš°íŒ… ë³€ê²½**
   - Intent Analyzer â†’ Eval Turn Guard (ì œì¶œ ì‹œ)
   - Writer LLMì„ ê±°ì¹˜ì§€ ì•Šê³  ë°”ë¡œ í‰ê°€ë¡œ ì§„í–‰

3. **ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ êµ¬í˜„**
   - ì¼ë°˜ ì±„íŒ… í›„ 4ë²ˆ Eval Turn SubGraphë¥¼ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰
   - Redisì— ìƒì„¸ turn_logs ì €ì¥

4. **Redis turn_logs êµ¬ì¡° ì¶”ê°€**
   - `turn_logs:{session_id}:{turn}` í‚¤ë¡œ ìƒì„¸ í‰ê°€ ë¡œê·¸ ì €ì¥
   - Chaining í‰ê°€(6a)ì—ì„œ í™œìš©

================================================================================
## 2. ê° ë…¸ë“œì˜ ì—­í•  ë° ì¶œë ¥ í˜•ì‹
================================================================================

### 2.1 ë©”ì¸ ê·¸ë˜í”„ ë…¸ë“œ

#### Node 1: Handle Request
**ì—­í• :**
- ìš”ì²­ ìˆ˜ì‹  ë° ì„¸ì…˜ ìƒíƒœ ë¡œë“œ
- í„´ ë²ˆí˜¸ ì¦ê°€
- ì´ˆê¸° ìƒíƒœ ì„¤ì •

**ì…ë ¥:**
```python
{
    "session_id": str,
    "exam_id": int,
    "participant_id": int,
    "spec_id": int,
    "human_message": str,
    "is_submitted": bool
}
```

**ì¶œë ¥:**
```python
{
    "current_turn": int,  # ì¦ê°€ëœ í„´ ë²ˆí˜¸
    "updated_at": str     # ISO í˜•ì‹ íƒ€ì„ìŠ¤íƒ¬í”„
}
```

**ë¡œê·¸:**
```
[1. Handle Request] ì§„ì… - session_id: xxx, ì´ì „ í„´: N, ìƒˆ í„´: N+1
[1. Handle Request] ì™„ë£Œ - session_id: xxx, í„´: N+1
```

---

#### Node 2: Intent Analyzer
**ì—­í• :**
- ì‚¬ìš©ì ì˜ë„ ë¶„ì„ (IntentClassification)
- ê°€ë“œë ˆì¼ ì²´í¬
- ì œì¶œ ìš”ì²­ ê°ì§€

**ì¶œë ¥:**
```python
{
    "intent_status": str,  # PASSED_HINT, PASSED_SUBMIT, FAILED_GUARDRAIL
    "is_guardrail_failed": bool,
    "guardrail_message": str,
    "updated_at": str
}
```

**ë¼ìš°íŒ…:**
- `PASSED_HINT` â†’ writer (ì¼ë°˜ ì±„íŒ…)
- `PASSED_SUBMIT` or `is_submitted=True` â†’ eval_turn_guard (ì œì¶œ)
- `FAILED_GUARDRAIL` â†’ handle_failure

**ë¡œê·¸:**
```
[Intent Analyzer] ë©”ì‹œì§€ ë¶„ì„ ì‹œì‘: {message}...
[Intent Analyzer] ë¶„ì„ ì™„ë£Œ - status: {status}, is_submission: {bool}
[Intent Router] ì œì¶œ ìš”ì²­ ê°ì§€ - eval_turn_guardë¡œ ì§„í–‰
```

---

#### Node 3: Writer LLM
**ì—­í• :**
- AI ë‹µë³€ ìƒì„±
- messages ë°°ì—´ì— í„´ ì •ë³´ í¬í•¨í•˜ì—¬ ì €ì¥
- í† í° ê´€ë¦¬

**ì¶œë ¥:**
```python
{
    "ai_message": str,
    "messages": [
        {
            "turn": int,
            "role": "user",
            "content": str,
            "timestamp": str
        },
        {
            "turn": int,
            "role": "assistant",
            "content": str,
            "timestamp": str
        }
    ],
    "writer_status": str,  # SUCCESS, FAILED_*
    "updated_at": str
}
```

**ë¼ìš°íŒ…:**
- `SUCCESS` + ì¼ë°˜ ì±„íŒ… â†’ END
- `SUCCESS` + ì œì¶œ â†’ eval_turn (ì‚¬ìš© ì•ˆ í•¨)
- `FAILED_*` â†’ handle_failure ë˜ëŠ” summarize_memory

**ë¡œê·¸:**
```
[Writer LLM] ë‹µë³€ ìƒì„± ì‹œì‘ - message: {message}...
[Writer LLM] ë‹µë³€ ìƒì„± ì„±ê³µ - ê¸¸ì´: {length} ë¬¸ì
[Writer Router] ë‹µë³€ ìƒì„± ì„±ê³µ - ë°”ë¡œ ì‘ë‹µ ë°˜í™˜ (END)
```

---

#### Node 4G: Eval Turn Guard (ìƒˆë¡œ ì¶”ê°€)
**ì—­í• :**
- ì œì¶œ ì‹œ ëª¨ë“  í„´ í‰ê°€ ì™„ë£Œ í™•ì¸
- Redisì—ì„œ turn_logs ì¡°íšŒ
- ëˆ„ë½ëœ í„´ ë°œê²¬ ì‹œ messages ë°°ì—´ì—ì„œ ë³µì›í•˜ì—¬ ì¬í‰ê°€
- turn_logsë¥¼ turn_scoresë¡œ ë³€í™˜í•˜ì—¬ state ì—…ë°ì´íŠ¸

**ì…ë ¥:**
```python
state = {
    "session_id": str,
    "current_turn": int,
    "messages": [...]  # ì „ì²´ ëŒ€í™” íˆìŠ¤í† ë¦¬
}
```

**ì¶œë ¥:**
```python
{
    "turn_scores": {
        "1": 85.5,
        "2": 92.0,
        "3": 78.3
    },
    "updated_at": str
}
```

**ì²˜ë¦¬ ë¡œì§:**
1. Redisì—ì„œ `turn_logs:{session_id}:*` íŒ¨í„´ìœ¼ë¡œ ëª¨ë“  í„´ ë¡œê·¸ ì¡°íšŒ
2. 1ë¶€í„° current_turnê¹Œì§€ ëˆ„ë½ëœ í„´ í™•ì¸
3. ëˆ„ë½ í„´ì´ ìˆìœ¼ë©´:
   - messages ë°°ì—´ì—ì„œ í•´ë‹¹ í„´ì˜ user/assistant ë©”ì‹œì§€ ì°¾ê¸°
   - `_evaluate_turn_sync()` í˜¸ì¶œí•˜ì—¬ ë™ê¸°ì ìœ¼ë¡œ ì¬í‰ê°€
   - Redisì— turn_log ì €ì¥
4. ëª¨ë“  turn_logsë¥¼ turn_scoresë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜

**ë¡œê·¸:**
```
[4. Eval Turn Guard] ì§„ì… - session_id: xxx, í˜„ì¬ í„´: N
[4. Eval Turn Guard] Redis í„´ ë¡œê·¸ ê°œìˆ˜: M
[4. Eval Turn Guard] ëˆ„ë½ëœ í„´ ë°œê²¬ - ëˆ„ë½: [1, 3, 4]
[4. Eval Turn Guard] ì „ì²´ messages ê°œìˆ˜: 6
[4. Eval Turn Guard] í„´ 1 ë©”ì‹œì§€ ê²€ìƒ‰ ì¤‘...
[4. Eval Turn Guard] í„´ 1ì˜ ë©”ì‹œì§€ ë°œê²¬: 2ê°œ
[4. Eval Turn Guard] í„´ 1 ì¬í‰ê°€ ì‹œì‘
[Eval Turn Sync] í„´ 1 ì¬í‰ê°€ ì €ì¥ ì™„ë£Œ - score: 85.5
[4. Eval Turn Guard] ì™„ë£Œ - ìµœì¢… í„´ ë¡œê·¸ ê°œìˆ˜: 3, turn_scores: {'1': 85.5, '2': 92.0, '3': 78.3}
```

---

#### Node 5: Main Router
**ì—­í• :**
- ì œì¶œ ì—¬ë¶€ í™•ì¸
- í‰ê°€ í”Œë¡œìš°ë¡œ ë¼ìš°íŒ…

**ë¼ìš°íŒ…:**
- `is_submitted=True` â†’ eval_holistic_flow
- ê¸°íƒ€ â†’ end

**ë¡œê·¸:**
```
[Main Router] ì œì¶œ ìš”ì²­ í™•ì¸ - eval_holistic_flowë¡œ ì§„í–‰
```

---

#### Node 6a: Eval Holistic Flow
**ì—­í• :**
- ì „ì²´ ëŒ€í™” íë¦„ í‰ê°€ (Chaining í‰ê°€)
- Redis turn_logs ì‚¬ìš©í•˜ì—¬ Problem Decomposition, Feedback Integration ë“± í‰ê°€
- LLM ê¸°ë°˜ í‰ê°€ (Gemini)

**ì…ë ¥:**
- Redisì—ì„œ `turn_logs:{session_id}:*` ì¡°íšŒ

**ì¶œë ¥:**
```python
{
    "holistic_flow_score": float  # 0-100
}
```

**ë¡œê·¸:**
```
[6a. Eval Holistic Flow] ì§„ì… - session_id: xxx
[6a. Eval Holistic Flow] í„´ ë¡œê·¸ ì¡°íšŒ - í„´ ê°œìˆ˜: N
[6a. Eval Holistic Flow] ì™„ë£Œ - score: 90.0
```

---

#### Node 6b: Aggregate Turn Scores
**ì—­í• :**
- turn_scores ì§‘ê³„
- í”„ë¡¬í”„íŠ¸ ì ìˆ˜ ê³„ì‚°

**ì…ë ¥:**
```python
{
    "turn_scores": {
        "1": 85.5,
        "2": 92.0,
        "3": 78.3
    }
}
```

**ì¶œë ¥:**
```python
{
    "aggregate_turn_score": float  # í‰ê· ê°’
}
```

**ë¡œê·¸:**
```
[6b. Aggregate Turn Scores] ì§„ì… - session_id: xxx
[6b. Aggregate Turn Scores] ìœ íš¨í•œ ì ìˆ˜ ê°œìˆ˜: N
```

---

#### Node 6c: Eval Code Performance
**ì—­í• :**
- ì œì¶œ ì½”ë“œ ì„±ëŠ¥ í‰ê°€
- Judge0 API ì—°ë™ (ì˜ˆì •)
- LLM ê¸°ë°˜ í‰ê°€ (í˜„ì¬)

**ì¶œë ¥:**
```python
{
    "code_performance_score": float  # 0-100
}
```

**ë¡œê·¸:**
```
[6c. Eval Code Performance] ì§„ì… - session_id: xxx
[6c. Eval Code Performance] ì½”ë“œ ê¸¸ì´ ë¶„ì„ - ê¸¸ì´: N
[6c. Eval Code Performance] ì™„ë£Œ - score: 33.00
```

---

#### Node 6d: Eval Code Correctness
**ì—­í• :**
- ì œì¶œ ì½”ë“œ ì •í™•ì„± í‰ê°€
- Judge0 API ì—°ë™ (ì˜ˆì •)
- LLM ê¸°ë°˜ í‰ê°€ (í˜„ì¬)

**ì¶œë ¥:**
```python
{
    "code_correctness_score": float  # 0-100
}
```

**ë¡œê·¸:**
```
[6d. Eval Code Correctness] ì§„ì… - session_id: xxx
[6d. Eval Code Correctness] ì™„ë£Œ - score: 67.00
```

---

#### Node 7: Aggregate Final Scores
**ì—­í• :**
- ìµœì¢… ì ìˆ˜ ì§‘ê³„
- ë“±ê¸‰ ì‚°ì • (A+, A, B, C, D, F)

**ì…ë ¥:**
```python
{
    "holistic_flow_score": float,
    "aggregate_turn_score": float,
    "code_performance_score": float,
    "code_correctness_score": float
}
```

**ì¶œë ¥:**
```python
{
    "final_scores": {
        "prompt_score": float,      # (holistic + aggregate_turn) / 2
        "performance_score": float,
        "correctness_score": float,
        "total_score": float,       # ê°€ì¤‘ í‰ê· 
        "grade": str                # A+, A, B, C, D, F
    }
}
```

**ê°€ì¤‘ì¹˜:**
- prompt_score: 40%
- performance_score: 30%
- correctness_score: 30%

**ë¡œê·¸:**
```
[7. Aggregate Final Scores] ì§„ì… - session_id: xxx
[7. Aggregate Final Scores] ì™„ë£Œ - ì´ì : 64.25, ë“±ê¸‰: D
```

---

### 2.2 Eval Turn SubGraph ë…¸ë“œ (Node 4)

#### Node 4.0: Intent Analysis
**ì—­í• :**
- í„´ì˜ ì˜ë„ ë¶„ì„ (7ê°€ì§€ íƒ€ì…)

**ì¶œë ¥:**
```python
{
    "intent_type": CodeIntentType,  # generation, optimization, debugging, etc.
    "intent_confidence": float
}
```

**ë¡œê·¸:**
```
[4.0 Intent Analysis] ì§„ì… - session_id: xxx, turn: N
[4.0 Intent Analysis] ì™„ë£Œ - ì˜ë„: generation, ì‹ ë¢°ë„: 0.95
```

---

#### Node 4.G-T: ê°œë³„ í‰ê°€ ë…¸ë“œ
- **4.G**: ì½”ë“œ ìƒì„± í‰ê°€
- **4.O**: ìµœì í™” í‰ê°€
- **4.D**: ë””ë²„ê¹… í‰ê°€
- **4.T**: í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í‰ê°€
- **4.H**: íŒíŠ¸/ì§ˆì˜ í‰ê°€
- **4.R**: ê·œì¹™ ì„¤ì • í‰ê°€
- **4.F**: í›„ì† ì‘ë‹µ í‰ê°€

**ê³µí†µ ì¶œë ¥ í˜•ì‹:**
```python
{
    "{eval_type}_eval": {
        "clarity": float,           # ëª…í™•ì„±
        "completeness": float,      # ì™„ì „ì„±
        "specificity": float,       # êµ¬ì²´ì„±
        "context": float,           # ë§¥ë½ í™œìš©
        "efficiency": float,        # íš¨ìœ¨ì„± (í•´ë‹¹ ì‹œ)
        "average": float,           # í‰ê· 
        "feedback": str             # í”¼ë“œë°±
    }
}
```

**ë¡œê·¸:**
```
[4.{X} {í‰ê°€ëª…} í‰ê°€] ì‹œì‘ - session_id: xxx, turn: N
[4.{X} {í‰ê°€ëª…} í‰ê°€] ì™„ë£Œ - score: 85.5
```

---

#### Node 4.X: Summarize Answer
**ì—­í• :**
- AI ë‹µë³€ ìš”ì•½ (100ì ì´ë‚´)

**ì¶œë ¥:**
```python
{
    "answer_summary": str
}
```

---

#### Node 4.4: Aggregate Turn Log
**ì—­í• :**
- í„´ í‰ê°€ ê²°ê³¼ ì§‘ê³„
- ìƒì„¸ turn_log ìƒì„± ë° Redis ì €ì¥

**ì¶œë ¥:**
```python
{
    "turn_score": float,
    "turn_log": {
        "turn_number": int,
        "user_prompt_summary": str,
        "prompt_evaluation_details": {
            "intent": str,
            "score": float,
            "rubrics": [
                {
                    "criterion": str,
                    "score": float,
                    "reason": str
                }
            ],
            "final_reasoning": str
        },
        "llm_answer_summary": str,
        "llm_answer_reasoning": str,
        "timestamp": str
    }
}
```

**ë¡œê·¸:**
```
[4.4 í„´ ë¡œê·¸ ì§‘ê³„] ì‹œì‘ - session_id: xxx, turn: N
[4.4 í„´ ë¡œê·¸ ì§‘ê³„] ì™„ë£Œ - í„´ ì ìˆ˜: 92.50, í‰ê°€ ê°œìˆ˜: 3
```

================================================================================
## 3. ìƒˆë¡œ ì¶”ê°€/ë³€ê²½ëœ íŒŒì¼
================================================================================

### 3.1 ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼

#### 1. `app/langgraph/nodes/eval_turn_guard.py` (â˜… í•µì‹¬)
**ì—­í• :**
- ì œì¶œ ì‹œ 4ë²ˆ ê°€ë“œ ë…¸ë“œ
- ëˆ„ë½ëœ í„´ ì¬í‰ê°€
- Redis turn_logs â†’ state turn_scores ë³€í™˜

**ì£¼ìš” í•¨ìˆ˜:**
- `eval_turn_submit_guard(state)`: ë©”ì¸ ê°€ë“œ ë¡œì§
- `_evaluate_turn_sync(session_id, turn, human_message, ai_message)`: ë™ê¸° ì¬í‰ê°€

**ì¶”ê°€ëœ ìœ„ì¹˜:**
```python
# app/langgraph/graph.py
from app.langgraph.nodes.eval_turn_guard import eval_turn_submit_guard

builder.add_node("eval_turn_guard", eval_turn_submit_guard)
```

---

#### 2. `test_chat_flow.py`
**ì—­í• :**
- ì‹¤ì œ ì±„íŒ…/ì œì¶œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- Redis turn_logs í™•ì¸

**ì‚¬ìš©ë²•:**
```bash
cd C:\P_project\LangGraph_1
uv run python test_chat_flow.py
```

---

#### 3. `test_submit_only.py`
**ì—­í• :**
- ì œì¶œ í”Œë¡œìš°ë§Œ ê°„ë‹¨íˆ í…ŒìŠ¤íŠ¸
- 3í„´ ëŒ€í™” + ì œì¶œ

**ì‚¬ìš©ë²•:**
```bash
cd C:\P_project\LangGraph_1
uv run python test_submit_only.py
```

---

### 3.2 ì£¼ìš” ë³€ê²½ëœ íŒŒì¼ (2025-11-27 ì¶”ê°€ ë³€ê²½ì‚¬í•­ í¬í•¨)

#### 0. **Redis í„´-ë©”ì‹œì§€ ë§¤í•‘ ì‹œìŠ¤í…œ** (â˜… ì‹ ê·œ í•µì‹¬ ê¸°ëŠ¥)

**ë¬¸ì œ:** messages ë°°ì—´ì— turn ì •ë³´ê°€ ë³´ì¡´ë˜ì§€ ì•Šì•„ ì¬í‰ê°€ ë¶ˆê°€ëŠ¥

**í•´ê²°:** Redisì— ë³„ë„ë¡œ í„´-ë©”ì‹œì§€ ì¸ë±ìŠ¤ ë§¤í•‘ ì €ì¥

**ì¶”ê°€ëœ í•¨ìˆ˜ (`app/db/redis_client.py`):**
```python
async def save_turn_mapping(session_id, turn, start_msg_idx, end_msg_idx):
    """í„´ì˜ messages ë°°ì—´ ì¸ë±ìŠ¤ ë§¤í•‘ ì €ì¥"""
    
async def get_turn_mapping(session_id):
    """ëª¨ë“  í„´ ë§¤í•‘ ì¡°íšŒ"""
    
async def get_turn_message_indices(session_id, turn):
    """íŠ¹ì • í„´ì˜ ì¸ë±ìŠ¤ ì¡°íšŒ"""
```

**Redis í‚¤ êµ¬ì¡°:**
```python
turn_mapping:{session_id} = {
    "1": {"start_msg_idx": 0, "end_msg_idx": 1},
    "2": {"start_msg_idx": 2, "end_msg_idx": 3},
    "3": {"start_msg_idx": 4, "end_msg_idx": 5}
}
```

**ì‚¬ìš© ìœ„ì¹˜:**
- `writer.py`: Writer LLMì´ ë‹µë³€ ìƒì„± í›„ ë§¤í•‘ ì €ì¥
- `eval_turn_guard.py`: ì œì¶œ ì‹œ ë§¤í•‘ì„ ì‚¬ìš©í•˜ì—¬ messagesì—ì„œ í„´ ë³µì›

---

#### 0-1. **ê°€ë“œë ˆì¼ ìœ„ë°˜ í„´ í‰ê°€ ì‹œìŠ¤í…œ** (â˜… ì‹ ê·œ í•µì‹¬ ê¸°ëŠ¥)

**ë¬¸ì œ:** ê°€ë“œë ˆì¼ ìœ„ë°˜ â†’ handle_failure â†’ í„´ í‰ê°€ ì—†ìŒ â†’ ë¶€ì ì ˆí•œ ìš”ì²­ ê¸°ë¡ ì•ˆ ë¨

**í•´ê²°:** ê°€ë“œë ˆì¼ ìœ„ë°˜ë„ Writer ê±°ì³ì„œ êµìœ¡ì  ë©”ì‹œì§€ ìƒì„± + í„´ í‰ê°€ ìˆ˜í–‰

**ë³€ê²½ì‚¬í•­:**
1. `writer_router.py`: FAILED_GUARDRAILë„ writerë¡œ ë¼ìš°íŒ… (ê¸°ì¡´: handle_failure)
2. `writer.py`: ê°€ë“œë ˆì¼ ìƒíƒœì— ë”°ë¼ ë‹¤ë¥¸ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì ìš©
   - ìœ„ë°˜ ì‹œ: êµìœ¡ì  ê±°ì ˆ ë©”ì‹œì§€ ìƒì„±
   - ì •ìƒ ì‹œ: ì†Œí¬ë¼í…ŒìŠ¤ì‹ íŠœí„°ë§
3. `states.py`: EvalTurnStateì— `is_guardrail_failed`, `guardrail_message` ì¶”ê°€
4. `subgraph_eval_turn.py`: ê°€ë“œë ˆì¼ ìœ„ë°˜ ì‹œ ì ìˆ˜ 0ì  ì²˜ë¦¬, turn_logì— ê¸°ë¡
5. `eval_service.py`: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì‹œ ê°€ë“œë ˆì¼ ì •ë³´ ì „ë‹¬

**í‰ê°€ íë¦„:**
```
ê°€ë“œë ˆì¼ ìœ„ë°˜ ê°ì§€ (Intent Analyzer)
  â†’ Writer (êµìœ¡ì  ê±°ì ˆ ë©”ì‹œì§€ ìƒì„±)
  â†’ ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ í‰ê°€ (is_guardrail_failed=True)
  â†’ turn_log ì €ì¥ (ì ìˆ˜ 0ì , ìœ„ë°˜ ì‚¬ì‹¤ ê¸°ë¡)
  â†’ END
```

---

#### 1. `app/langgraph/graph.py`
**ë³€ê²½ ë‚´ìš©:**
- `eval_turn_guard` ë…¸ë“œ ì¶”ê°€
- Intent Analyzer ë¼ìš°íŒ… ë³€ê²½
  - ì œì¶œ ì‹œ: `eval_turn_guard` â†’ `main_router` â†’ `eval_holistic_flow`
  
**ê¸°ì¡´:**
```python
builder.add_conditional_edges(
    "intent_analyzer",
    intent_router,
    {
        "writer": "writer",
        "main_router": "eval_holistic_flow",  # ì œì¶œ ì‹œ ë°”ë¡œ 6aë¡œ
    }
)
```

**ë³€ê²½ í›„:**
```python
builder.add_conditional_edges(
    "intent_analyzer",
    intent_router,
    {
        "writer": "writer",
        "eval_turn_guard": "eval_turn_guard",  # ì œì¶œ ì‹œ 4Gë¡œ
    }
)

builder.add_conditional_edges(
    "eval_turn_guard",
    main_router,
    {
        "eval_holistic_flow": "eval_holistic_flow",  # 4G â†’ 5 â†’ 6a
    }
)
```

---

#### 2. `app/langgraph/nodes/writer_router.py`
**ë³€ê²½ ë‚´ìš©:**
- `intent_router` í•¨ìˆ˜ ìˆ˜ì •
  - ì œì¶œ ì‹œ `eval_turn_guard` ë°˜í™˜

**ë³€ê²½ ì½”ë“œ:**
```python
def intent_router(state: MainGraphState) -> Literal[
    "writer",
    "handle_failure",
    "summarize_memory",
    "handle_request",
    "eval_turn_guard"  # ì¶”ê°€
]:
    is_submitted = state.get("is_submitted", False)
    
    if is_submitted or intent_status == IntentAnalyzerStatus.PASSED_SUBMIT.value:
        logger.info("[Intent Router] ì œì¶œ ìš”ì²­ ê°ì§€ - eval_turn_guardë¡œ ì§„í–‰")
        return "eval_turn_guard"  # ë³€ê²½
```

---

#### 3. `app/services/eval_service.py`
**ë³€ê²½ ë‚´ìš©:**
- ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ ì‹¤í–‰ ë¡œì§ êµ¬í˜„ (`_run_eval_turn_background`)
- Redis turn_logs ì €ì¥

**ì¶”ê°€ëœ í•¨ìˆ˜:**
```python
async def _run_eval_turn_background(self, session_id: str, result: dict):
    """ë°±ê·¸ë¼ìš´ë“œë¡œ 4ë²ˆ ë…¸ë“œ(Eval Turn) ì‹¤í–‰"""
    try:
        turn = result.get("current_turn")
        human_msg = result.get("human_message")
        ai_msg = result.get("ai_message")
        
        # Eval Turn SubGraph ì‹¤í–‰
        eval_turn_subgraph = create_eval_turn_subgraph()
        turn_state = {...}
        turn_result = await eval_turn_subgraph.ainvoke(turn_state)
        
        # Redisì— ìƒì„¸ turn_log ì €ì¥
        detailed_turn_log = {
            "turn_number": turn,
            "prompt_evaluation_details": {...},
            "llm_answer_summary": "...",
            ...
        }
        await redis_client.save_turn_log(session_id, turn, detailed_turn_log)
        
    except Exception as e:
        logger.error(f"ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ ì‹¤íŒ¨: {e}")
```

---

#### 4. `app/db/redis_client.py`
**ë³€ê²½ ë‚´ìš©:**
- `save_turn_log()` í•¨ìˆ˜ ì¶”ê°€
- `get_all_turn_logs()` í•¨ìˆ˜ ì¶”ê°€

**ì¶”ê°€ëœ í•¨ìˆ˜:**
```python
async def save_turn_log(self, session_id: str, turn: int, turn_log: dict):
    """í„´ ë¡œê·¸ ì €ì¥"""
    key = f"turn_logs:{session_id}:{turn}"
    await self.set_json(key, turn_log, ttl_seconds=3600)

async def get_all_turn_logs(self, session_id: str) -> dict:
    """ëª¨ë“  í„´ ë¡œê·¸ ì¡°íšŒ"""
    pattern = f"turn_logs:{session_id}:*"
    keys = []
    async for key in self.client.scan_iter(pattern):
        keys.append(key)
    
    logs = {}
    for key in keys:
        turn = key.split(":")[-1]
        log = await self.get_json(key)
        logs[turn] = log
    
    return logs
```

---

#### 5. `app/db/repositories/state_repo.py`
**ë³€ê²½ ë‚´ìš©:**
- `_serialize_messages()` í•¨ìˆ˜ ì¶”ê°€
- `save_state()` í•¨ìˆ˜ ìˆ˜ì • (messages ì§ë ¬í™”)

**ì¶”ê°€ëœ ì½”ë“œ:**
```python
def _serialize_messages(self, messages: list) -> list:
    """LangChain ë©”ì‹œì§€ ê°ì²´ë¥¼ JSON ì§ë ¬í™” ê°€ëŠ¥í•œ dictë¡œ ë³€í™˜"""
    serialized = []
    for msg in messages:
        if hasattr(msg, '__dict__'):
            serialized_msg = {
                "type": getattr(msg, 'type', 'unknown'),
                "content": getattr(msg, 'content', ''),
            }
            # turn, role, timestamp ë“± ì¶”ê°€ ì†ì„± ë³´ì¡´
            for key in ['turn', 'role', 'timestamp']:
                if hasattr(msg, key):
                    serialized_msg[key] = getattr(msg, key)
        elif isinstance(msg, dict):
            serialized_msg = msg
        else:
            serialized_msg = {"content": str(msg)}
        
        serialized.append(serialized_msg)
    
    return serialized
```

---

#### 6. ëª¨ë“  í‰ê°€ ë…¸ë“œì— ë¡œê·¸ ì¶”ê°€
**ë³€ê²½ëœ íŒŒì¼:**
- `app/langgraph/nodes/handle_request.py`
- `app/langgraph/nodes/evaluators.py`
- `app/langgraph/subgraph_eval_turn.py`

**ì¶”ê°€ëœ ë¡œê·¸ í˜•ì‹:**
```python
logger.info(f"[{ë…¸ë“œëª…}] ì§„ì… - session_id: {session_id}, turn: {turn}")
logger.info(f"[{ë…¸ë“œëª…}] ì™„ë£Œ - session_id: {session_id}, score: {score}")
logger.error(f"[{ë…¸ë“œëª…}] ì˜¤ë¥˜ - session_id: {session_id}, error: {str(e)}", exc_info=True)
```

================================================================================
## 4. í…ŒìŠ¤íŠ¸ ì§„í–‰ ìƒí™©
================================================================================

### 4.1 í…ŒìŠ¤íŠ¸ í™˜ê²½
- **OS**: Windows 10
- **Python**: 3.10.19
- **Redis**: ì‹¤í–‰ ì¤‘ (localhost:6379)
- **PostgreSQL**: ì‹¤í–‰ ì¤‘ (localhost:5435)
- **FastAPI**: http://localhost:8000

### 4.2 í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì¼ë°˜ ì±„íŒ… (3í„´)
```
Turn 1: "í”¼ë³´ë‚˜ì¹˜ í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”"
Turn 2: "O(n)ìœ¼ë¡œ ìµœì í™”í•´ì£¼ì„¸ìš”"
Turn 3: "ì—ì§€ ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”"
```

**ê²°ê³¼:**
- âœ… ëª¨ë“  í„´ì—ì„œ AI ì‘ë‹µ ìƒì„± ì„±ê³µ
- âœ… ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ ì‹¤í–‰ í™•ì¸ (Turn 2, 3)
- âŒ Turn 1ì˜ ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ëˆ„ë½
- âœ… Redisì— turn_logs ì €ì¥ í™•ì¸ (í„´ 2, 3ë§Œ)

---

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì œì¶œ
```
ì½”ë“œ: def fib(n): return n if n <= 1 else fib(n-1) + fib(n-2)
```

**ê²°ê³¼:**
```json
{
  "is_submitted": true,
  "final_scores": {
    "prompt_score": 91.25,
    "performance_score": 30.0,
    "correctness_score": 46.0,
    "total_score": 53.31,
    "grade": "F"
  },
  "turn_scores": {
    "2": 100.0  // âŒ í„´ 1, 3 ëˆ„ë½
  }
}
```

**í”Œë¡œìš° í™•ì¸:**
- âœ… [1. Handle Request] ì •ìƒ ì‹¤í–‰
- âœ… [2. Intent Analyzer] ì œì¶œ ê°ì§€
- âœ… [4. Eval Turn Guard] ëˆ„ë½ í„´ ë°œê²¬ [1, 3, 4]
- âŒ [4. Eval Turn Guard] ì¬í‰ê°€ ì‹¤íŒ¨ (messagesì—ì„œ í„´ ì •ë³´ ì°¾ì§€ ëª»í•¨)
- âš ï¸  [4. Eval Turn Guard] turn_scoresì— í„´ 2ë§Œ ì €ì¥
- âœ… [6a. Eval Holistic Flow] ì •ìƒ ì‹¤í–‰ (score: 91.25)
- âš ï¸  [6b. Aggregate Turn Scores] í„´ ì ìˆ˜ ë¶€ì¡± ê²½ê³ 
- âœ… [6c-d, 7] ì½”ë“œ í‰ê°€ ë° ìµœì¢… ì§‘ê³„ ì •ìƒ

### 4.3 í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´
```bash
# 1. Docker ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps -a --filter "name=ai_vibe"

# 2. FastAPI ì„œë²„ ì‹¤í–‰
cd C:\P_project\LangGraph_1
uv run scripts/run_dev.py

# 3. ì œì¶œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
uv run python test_submit_only.py

# 4. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
uv run python test_chat_flow.py

# 5. ì„œë²„ ë¡œê·¸ í™•ì¸
Get-Content "í„°ë¯¸ë„ê²½ë¡œ\3.txt" -Tail 100

# 6. Redis ì§ì ‘ í™•ì¸ (ì„ íƒ)
docker exec -it ai_vibe_redis_dev redis-cli
> KEYS turn_logs:*
> GET turn_logs:session-xxx:2
```

================================================================================
## 5. ë°œê²¬ëœ ë¬¸ì œ ë° ì˜¤ë¥˜
================================================================================

### 5.0 í…ŒìŠ¤íŠ¸ ì¤‘ ë°œìƒí•œ ì˜¤ë¥˜ ë¡œê·¸ (ì‹œê°„ìˆœ)

#### ì˜¤ë¥˜ 1: HumanMessage is not JSON serializable (í•´ê²°ë¨ âœ…)
**ë°œìƒ ì‹œì :** 2025-11-27 03:00:51
**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
TypeError: Object of type HumanMessage is not JSON serializable
```

**ì›ì¸:**
- `state_repo.py`ì˜ `save_state()`ì—ì„œ LangChain ë©”ì‹œì§€ ê°ì²´ë¥¼ ì§ë ¬í™”í•˜ì§€ ëª»í•¨
- Redisì— ì €ì¥í•  ë•Œ JSON ë³€í™˜ ì‹¤íŒ¨

**í•´ê²°:**
```python
# state_repo.py
def _serialize_messages(self, messages: list) -> list:
    """LangChain ë©”ì‹œì§€ ê°ì²´ë¥¼ JSON ì§ë ¬í™” ê°€ëŠ¥í•œ dictë¡œ ë³€í™˜"""
    for msg in messages:
        if hasattr(msg, '__dict__'):
            serialized_msg = {
                "type": getattr(msg, 'type', 'unknown'),
                "content": getattr(msg, 'content', ''),
            }
```

---

#### ì˜¤ë¥˜ 2: Turn Scores ëˆ„ë½ (ë¶€ë¶„ í•´ê²° âš ï¸)
**ë°œìƒ ì‹œì :** 2025-11-27 03:07:25 ~ 03:23:43
**ì¦ìƒ:**
```json
"turn_scores": {
  "2": 100.0  // Turn 1, 3 ëˆ„ë½
}
```

**ì›ì¸ 1: messages ë°°ì—´ì— turn ì •ë³´ ì—†ìŒ**
- `writer.py`ì—ì„œ turn ì •ë³´ë¥¼ dictë¡œ ì¶”ê°€í–ˆì§€ë§Œ
- Redis ì €ì¥ ì‹œ LangChain ê°ì²´ë¡œ ë³€í™˜ë˜ë©´ì„œ ì»¤ìŠ¤í…€ ì†ì„± ì†ì‹¤
- `eval_turn_guard`ê°€ ì¬í‰ê°€í•  ìˆ˜ ì—†ìŒ

**ë¡œê·¸:**
```
[4. Eval Turn Guard] ëˆ„ë½ëœ í„´ ë°œê²¬: [1, 3, 4]
[4. Eval Turn Guard] ì „ì²´ messages ê°œìˆ˜: 6
[4. Eval Turn Guard] í„´ 1ì˜ ë©”ì‹œì§€ ë°œê²¬: 0ê°œ  â† turn í‚¤ê°€ ì—†ìŒ
```

**í•´ê²°:**
- Redisì— ë³„ë„ `turn_mapping:{session_id}` ì €ì¥
- messages ë°°ì—´ ì¸ë±ìŠ¤ë¡œ í„´ ë³µì›

---

#### ì˜¤ë¥˜ 3: ë‹¤ì¤‘ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ (í•´ê²°ë¨ âœ…)
**ë°œìƒ ì‹œì :** 2025-11-27 03:50:00
**ì¦ìƒ:**
```
TCP    0.0.0.0:8000    LISTENING    PID 5108
TCP    0.0.0.0:8000    LISTENING    PID 6156
```

**ì›ì¸:**
- ì´ì „ ì„œë²„ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì§€ ì•ŠìŒ
- ìƒˆ ì„œë²„ê°€ ì¶”ê°€ë¡œ ì‹œì‘ë¨
- ìš”ì²­ì´ ì˜ëª»ëœ ì„œë²„ë¡œ ì „ë‹¬

**í•´ê²°:**
```bash
taskkill /PID 5108 /F
taskkill /PID 6156 /F
```

---

#### ì˜¤ë¥˜ 4: Gemini API Quota ì´ˆê³¼ (ì§„í–‰ ì¤‘ âŒ)
**ë°œìƒ ì‹œì :** 2025-11-27 04:26:22
**ì˜¤ë¥˜ ë©”ì‹œì§€:**
```
429 You exceeded your current quota, please check your plan and billing details.
https://ai.google.dev/gemini-api/docs/rate-limits
```

**ì›ì¸:**
- ì§§ì€ ì‹œê°„ì— ë‹¤ìˆ˜ì˜ LLM í˜¸ì¶œ (Turnë‹¹ 5íšŒ)
- Gemini API ë¬´ë£Œ í• ë‹¹ëŸ‰: 15 RPM, 32,000 TPM
- í…ŒìŠ¤íŠ¸ 3í„´ = ì•½ 15íšŒ LLM í˜¸ì¶œ â†’ Quota ë„ë‹¬

**ì˜í–¥:**
- Turn 2 ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì¤‘ Summarize Answer ì‹¤íŒ¨
- Turn 3 Writer LLM í˜¸ì¶œ íƒ€ì„ì•„ì›ƒ
- ì œì¶œ í”Œë¡œìš° íƒ€ì„ì•„ì›ƒ

**í•´ê²° ë°©ì•ˆ:**
1. API Quota íšŒë³µ ëŒ€ê¸° (1ë¶„ ~ ë‹¤ìŒ ë‚ )
2. í…ŒìŠ¤íŠ¸ ê°„ê²© ì¦ê°€ (10ì´ˆ ì´ìƒ)
3. LLM í˜¸ì¶œ ìµœì í™” (Summarize ì„ íƒì  ì‹¤í–‰)
4. Rate Limit ì¬ì‹œë„ ë¡œì§ ê°œì„ 

**í˜„ì¬ ìƒíƒœ:** ë¯¸í•´ê²° (API í• ë‹¹ëŸ‰ íšŒë³µ í•„ìš”)

---

#### ì˜¤ë¥˜ 5: ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ íƒ€ì´ë° (ë¶€ë¶„ í•´ê²° âš ï¸)
**ë°œìƒ ì‹œì :** 2025-11-27 03:19:45 ~ 04:19:34
**ì¦ìƒ:**
- Turn 3 ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ê°€ ì œì¶œ ì‹œì‘ í›„ì— ì™„ë£Œë¨
- `eval_turn_guard`ì—ì„œ Turn 3ì„ ì°¾ì§€ ëª»í•¨

**íƒ€ì„ë¼ì¸:**
```
04:19:07 - Turn 3 ì±„íŒ… ì™„ë£Œ, ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì‹œì‘
04:19:34 - ì œì¶œ ìš”ì²­ ë„ì°© (27ì´ˆ í›„)
04:19:34 - eval_turn_guard: Turn 3 ì—†ìŒ í™•ì¸
04:19:41 - Turn 3 ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì™„ë£Œ (ëŠ¦ìŒ!)
```

**í•´ê²°:**
- `eval_turn_guard`ì— ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì™„ë£Œ ëŒ€ê¸° ë¡œì§ ì¶”ê°€ (ìµœëŒ€ 10ì´ˆ)
```python
while total_waited < max_wait_seconds:
    all_turn_logs = await redis_client.get_all_turn_logs(session_id)
    if expected_turns.issubset(existing_turns):
        break
    await asyncio.sleep(0.5)
```

**í˜„ì¬ ìƒíƒœ:** êµ¬í˜„ ì™„ë£Œ, Quota ë¬¸ì œë¡œ í…ŒìŠ¤íŠ¸ ë¯¸ì™„

---

### 5.1 âŒ í•µì‹¬ ë¬¸ì œ: messages ë°°ì—´ì— turn ì •ë³´ ëˆ„ë½ (í•´ê²°ë¨ âœ…)

**ë¬¸ì œ ìƒí™©:**
```python
# ê¸°ëŒ€í•˜ëŠ” í˜•ì‹ (writer.pyì—ì„œ ìƒì„±)
messages = [
    {
        "turn": 1,
        "role": "user",
        "content": "...",
        "timestamp": "2025-11-27T..."
    },
    {
        "turn": 1,
        "role": "assistant",
        "content": "...",
        "timestamp": "2025-11-27T..."
    }
]

# ì‹¤ì œ stateì—ì„œ ê°€ì ¸ì˜¨ í˜•ì‹ (eval_turn_guard.py)
messages = [
    {
        "type": "user",
        "content": "..."
        # turn ì •ë³´ ì—†ìŒ!
    },
    {
        "type": "ai",
        "content": "..."
        # turn ì •ë³´ ì—†ìŒ!
    }
]
```

**ì›ì¸ ë¶„ì„:**
1. `writer.py`ì—ì„œëŠ” turn ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ messages ìƒì„±
2. `state_repo.py`ì˜ `_serialize_messages()`ê°€ LangChain ë©”ì‹œì§€ ê°ì²´ë¥¼ dictë¡œ ë³€í™˜
3. **ë³€í™˜ ê³¼ì •ì—ì„œ turn, role, timestamp ì†ì„±ì´ ëˆ„ë½ë¨**
4. Redisì— ì €ì¥ëœ stateì˜ messagesì— turn ì •ë³´ ì—†ìŒ
5. ì œì¶œ ì‹œ `eval_turn_guard`ê°€ messagesì—ì„œ í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ê·¼ë³¸ ì›ì¸:**
- LangChainì˜ `HumanMessage`, `AIMessage` ê°ì²´ëŠ” `turn`, `role`, `timestamp` ì†ì„±ì„ ì§ì ‘ ì§€ì›í•˜ì§€ ì•ŠìŒ
- `writer.py`ì—ì„œ dict í˜•íƒœë¡œ messagesë¥¼ ì¶”ê°€í–ˆì§€ë§Œ, LangGraph ìƒíƒœ ê´€ë¦¬ ê³¼ì •ì—ì„œ LangChain ë©”ì‹œì§€ ê°ì²´ë¡œ ë³€í™˜ë¨
- `_serialize_messages()`ê°€ ì´ëŸ¬í•œ ì»¤ìŠ¤í…€ ì†ì„±ì„ ë³´ì¡´í•˜ì§€ ëª»í•¨

**ë¡œê·¸ ì¦ê±°:**
```
[4. Eval Turn Guard] ì „ì²´ messages ê°œìˆ˜: 6
[4. Eval Turn Guard] ì²« ë©”ì‹œì§€ - íƒ€ì…: <class 'dict'>, í‚¤: ['type', 'content']
[4. Eval Turn Guard] í„´ 1 ë©”ì‹œì§€ ê²€ìƒ‰ ì¤‘...
[4. Eval Turn Guard] í„´ 1ì˜ ë©”ì‹œì§€ ë°œê²¬: 0ê°œ  // âŒ turn í‚¤ê°€ ì—†ì–´ì„œ ì°¾ì§€ ëª»í•¨
```

---

### 5.2 âš ï¸  ë¶€ì°¨ì  ë¬¸ì œ

#### ë¬¸ì œ 2: Turn 1ì˜ ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ëˆ„ë½
**ì¦ìƒ:**
- Turn 1 ì±„íŒ… í›„ ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ ì‹¤í–‰ ì•ˆ ë¨
- Redisì— `turn_logs:session:1` ì—†ìŒ

**ì›ì¸:**
- `eval_service.py`ì˜ `_run_eval_turn_background()` í˜¸ì¶œ ì¡°ê±´
```python
if not is_submission and result.get("ai_message"):
    asyncio.create_task(self._run_eval_turn_background(session_id, result))
```
- Turn 1ì—ì„œ `ai_message`ê°€ Noneì¸ ê²½ìš° ë°œìƒ (ì´ì „ í…ŒìŠ¤íŠ¸ì—ì„œ í™•ì¸)

---

#### ë¬¸ì œ 3: turn_scores ë³€í™˜ ë¡œì§ ë¶ˆì™„ì „
**ì¦ìƒ:**
- Redisì— turn_logsëŠ” ìˆì§€ë§Œ turn_scoresì— ì¼ë¶€ë§Œ ë°˜ì˜

**ì›ì¸:**
- `eval_turn_guard.py`ì˜ turn_logs â†’ turn_scores ë³€í™˜ ë¡œì§
```python
for turn_key, turn_log in updated_turn_logs.items():
    if isinstance(turn_log, dict) and "prompt_evaluation_details" in turn_log:
        turn_scores[turn_key] = turn_log["prompt_evaluation_details"].get("score", 0)
```
- Redisì—ì„œ ì¡°íšŒí•œ turn_logsê°€ ë¶ˆì™„ì „í•œ ê²½ìš° ì ìˆ˜ ì¶”ì¶œ ì‹¤íŒ¨

---

#### ë¬¸ì œ 4: HumanMessage is not JSON serializable
**ì¦ìƒ:**
```
TypeError: Object of type HumanMessage is not JSON serializable
```

**í•´ê²°:**
- `state_repo.py`ì— `_serialize_messages()` ì¶”ê°€
- Redis ì €ì¥ ì „ LangChain ë©”ì‹œì§€ ê°ì²´ë¥¼ dictë¡œ ë³€í™˜

**ìƒíƒœ:** âœ… í•´ê²°ë¨

---

### 5.3 ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ì´ìŠˆ

**ì§€ì  ì‚¬í•­ (ì‚¬ìš©ì):**
> "PostgreSQL ERDì™€ Redis session ê´€ë¦¬ë¥¼ ì˜ˆì‹œë¡œ ì£¼ì§€ ì•Šê³ , ì½”ë“œ ë¦¬ë·°ë¥¼ í•˜ì§€ ì•Šì•„ì„œ ìƒê¸´ ë¬¸ì œ"

**í˜„ì¬ ìƒí™©:**
1. **PostgreSQL**
   - í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜ë˜ì–´ ìˆìŒ (`app/db/models/`)
   - ì‹¤ì œ ë°ì´í„° ì—°ë™ ë¯¸êµ¬í˜„ (ì‹œí—˜ ë¬¸ì œ, ì°¸ê°€ì ì •ë³´ ë“±)
   - í‰ê°€ ê²°ê³¼ ì €ì¥ ë¡œì§ ë¯¸êµ¬í˜„

2. **Redis**
   - ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬ (`graph_state:{session_id}`)
   - turn_logs ì €ì¥ (`turn_logs:{session_id}:{turn}`)
   - **ë¬¸ì œ**: messages ë°°ì—´ êµ¬ì¡°ê°€ ëª…í™•í•˜ì§€ ì•ŠìŒ
   - **ë¬¸ì œ**: TTL ê´€ë¦¬, í‚¤ ë„¤ì´ë° ê·œì¹™ ë¶ˆëª…í™•

**í•„ìš”í•œ ê°œì„ :**
- PostgreSQL ERD ë¬¸ì„œí™”
- Redis í‚¤ êµ¬ì¡° í‘œì¤€í™”
- ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

================================================================================
## 6. ë‹¤ìŒ ë‹¨ê³„
================================================================================

### 6.1 ê¸´ê¸‰ ìˆ˜ì • í•„ìš” (P0 - Critical)

#### âœ… Task 1: messages ë°°ì—´ turn ì •ë³´ ë³´ì¡´ (ì™„ë£Œ)
**ëª©í‘œ:** stateì— ì €ì¥ë˜ëŠ” messagesì— turn, role, timestamp ì •ë³´ ìœ ì§€

**ì„ íƒí•œ ë°©ë²•: Redis í„´-ë©”ì‹œì§€ ë§¤í•‘ (Option C)**
- âœ… Redisì— `turn_mapping:{session_id}` ì €ì¥
- âœ… writer.pyì—ì„œ ë§¤í•‘ ìë™ ì €ì¥
- âœ… eval_turn_guard.pyì—ì„œ ë§¤í•‘ ì‚¬ìš©í•˜ì—¬ ì¬í‰ê°€
- **ì¥ì **: LangChain êµ¬ì¡°ì™€ ë…ë¦½ì , ì•ˆì •ì 

**ê¸°ì¡´ ë°©ë²• A: writer.pyì—ì„œ LangChain ë©”ì‹œì§€ í™•ì¥** (ë¯¸ì±„íƒ)
```python
# writer.py
from langchain_core.messages import HumanMessage, AIMessage

# ì»¤ìŠ¤í…€ ì†ì„± ì¶”ê°€
human_msg = HumanMessage(content=human_message)
human_msg.turn = current_turn
human_msg.timestamp = datetime.utcnow().isoformat()

ai_msg = AIMessage(content=ai_content)
ai_msg.turn = current_turn
ai_msg.timestamp = datetime.utcnow().isoformat()

return {
    "messages": [human_msg, ai_msg],
    ...
}
```

**ë°©ë²• B: state_repo.py ì§ë ¬í™” ë¡œì§ ê°œì„ **
```python
def _serialize_messages(self, messages: list) -> list:
    serialized = []
    for msg in messages:
        if hasattr(msg, '__dict__'):
            # ëª¨ë“  ì†ì„± ì¶”ì¶œ
            msg_dict = {
                "type": getattr(msg, 'type', 'unknown'),
                "content": getattr(msg, 'content', ''),
            }
            # ì»¤ìŠ¤í…€ ì†ì„± ì¶”ê°€
            for key in dir(msg):
                if not key.startswith('_') and key not in ['type', 'content']:
                    try:
                        value = getattr(msg, key)
                        if not callable(value):
                            msg_dict[key] = value
                    except:
                        pass
            serialized_msg = msg_dict
        # ...
```

**ë°©ë²• C: ë³„ë„ í„´ ë§¤í•‘ ì €ì¥** (â˜… ì¶”ì²œ)
```python
# Redisì— ë³„ë„ë¡œ í„´ ë§¤í•‘ ì €ì¥
turn_mapping = {
    1: {"start_msg_idx": 0, "end_msg_idx": 1},
    2: {"start_msg_idx": 2, "end_msg_idx": 3},
    3: {"start_msg_idx": 4, "end_msg_idx": 5},
}
await redis_client.set_json(f"turn_mapping:{session_id}", turn_mapping)

# eval_turn_guardì—ì„œ ì‚¬ìš©
mapping = await redis_client.get_json(f"turn_mapping:{session_id}")
for turn in missing_turns:
    indices = mapping.get(str(turn))
    if indices:
        human_msg = messages[indices["start_msg_idx"]]
        ai_msg = messages[indices["end_msg_idx"]]
```

---

#### âš ï¸ Task 2: Turn 1 ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ëˆ„ë½ í•´ê²° (ë¶€ë¶„ í•´ê²°)
**ì›ì¸:** ì²« í„´ì—ì„œ `ai_message`ê°€ None

**í˜„ì¬ ìƒíƒœ:** 
- ê°€ë“œë ˆì¼ ìœ„ë°˜ í„´ë„ í‰ê°€í•˜ë„ë¡ ê°œì„ ë¨
- í•˜ì§€ë§Œ Turn 1 ëˆ„ë½ ë¬¸ì œëŠ” ì—¬ì „íˆ ì¡´ì¬ ê°€ëŠ¥

**ì¶”ê°€ í™•ì¸ í•„ìš”:**
```python
# eval_service.py - process_message()
if not is_submission and result.get("ai_message"):  # â† ai_message ì²´í¬ í•„ìš”
    asyncio.create_task(self._run_eval_turn_background(session_id, result))
```

**í•´ê²° ë°©ì•ˆ:**
- writer_statusê°€ SUCCESSë©´ ë¬´ì¡°ê±´ ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ì‹¤í–‰
- ë˜ëŠ” stateì—ì„œ ai_message í™•ì¸ ë¡œì§ ê°œì„ 

---

#### âœ… Task 2-1: ê°€ë“œë ˆì¼ ìœ„ë°˜ í„´ í‰ê°€ ì¶”ê°€ (ì™„ë£Œ)
**ëª©í‘œ:** ë¶€ì ì ˆí•œ ìš”ì²­ë„ í„´ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬ í‰ê°€

**êµ¬í˜„ ì™„ë£Œ:**
- âœ… ê°€ë“œë ˆì¼ ìœ„ë°˜ë„ writerë¡œ ë¼ìš°íŒ…
- âœ… êµìœ¡ì  ê±°ì ˆ ë©”ì‹œì§€ ìƒì„±
- âœ… ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ í‰ê°€ ì‹¤í–‰ (ì ìˆ˜ 0ì )
- âœ… turn_logì— ìœ„ë°˜ ì‚¬ì‹¤ ê¸°ë¡
- âœ… Redisì— ì €ì¥

**íš¨ê³¼:**
- ì‚¬ìš©ìê°€ ë¶€ì ì ˆí•œ ìš”ì²­ì„ ëª‡ ë²ˆ ì‹œë„í–ˆëŠ”ì§€ ì¶”ì  ê°€ëŠ¥
- êµìœ¡ì  í”¼ë“œë°± ì œê³µ
- í‰ê°€ ë°ì´í„° ì™„ì „ì„± í™•ë³´

---

### 6.2 ì¤‘ìš” ê°œì„  ì‚¬í•­ (P1 - High)

#### Task 3: PostgreSQL ERD ë¬¸ì„œí™”
**ë‚´ìš©:**
- ëª¨ë“  í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë‹¤ì´ì–´ê·¸ë¨
- í…Œì´ë¸” ê°„ ê´€ê³„ (FK)
- ì¸ë±ìŠ¤ ì „ëµ
- ìƒ˜í”Œ ë°ì´í„°

**íŒŒì¼:** `docs/database_erd.md`

---

#### Task 4: Redis í‚¤ êµ¬ì¡° í‘œì¤€í™”
**ë‚´ìš©:**
```
graph_state:{session_id}              # ì„¸ì…˜ ìƒíƒœ
turn_logs:{session_id}:{turn}         # í„´ í‰ê°€ ë¡œê·¸
turn_mapping:{session_id}             # í„´-ë©”ì‹œì§€ ë§¤í•‘ (ì‹ ê·œ)
eval:scores:{session_id}              # ìµœì¢… ì ìˆ˜
memory:summary:{session_id}           # ë©”ëª¨ë¦¬ ìš”ì•½
checkpoint:{session_id}:{checkpoint}  # ì²´í¬í¬ì¸íŠ¸
```

**ë¬¸ì„œ:** `docs/redis_structure.md`

---

#### Task 5: Judge0 API ì—°ë™
**ëª©í‘œ:** ì‹¤ì œ ì½”ë“œ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

**ì‘ì—…:**
1. Judge0 Docker ì»¨í…Œì´ë„ˆ ì„¤ì •
2. `eval_code_performance` ë…¸ë“œì— ì—°ë™
3. `eval_code_correctness` ë…¸ë“œì— ì—°ë™
4. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì •ì˜

---

#### Task 6: Langsmith ì¶”ì  í™œì„±í™”
**ì„¤ì •:**
```bash
# .env
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=<your_key>
LANGCHAIN_PROJECT=ai-vibe-coding-test
```

---

### 6.3 ì¶”ê°€ ê¸°ëŠ¥ (P2 - Medium)

#### Task 7: ì „ì²´ ì½”ë“œ ë¦¬ë·°
**í•­ëª©:**
- íƒ€ì… íŒíŠ¸ ì™„ì„±ë„
- ì—ëŸ¬ í•¸ë“¤ë§
- ë¡œê¹… ì¼ê´€ì„±
- í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

---

#### Task 8: API ì‘ë‹µ í˜•ì‹ í‘œì¤€í™”
**í˜„ì¬:**
```json
{
  "session_id": "xxx",
  "turn": 3,
  "ai_message": "...",
  "turn_scores": {...},
  "final_scores": {...}
}
```

**ê°œì„ :**
```json
{
  "success": true,
  "data": {
    "session_id": "xxx",
    "turn": 3,
    "ai_message": "...",
    "scores": {...}
  },
  "metadata": {
    "timestamp": "2025-11-27T...",
    "execution_time_ms": 1234
  }
}
```

---

#### Task 9: ì„±ëŠ¥ ìµœì í™”
- Redis ì—°ê²° í’€ë§
- LLM í˜¸ì¶œ ë°°ì¹˜ ì²˜ë¦¬
- ìºì‹± ì „ëµ
- ë¹„ë™ê¸° I/O ìµœì í™”

---

### 6.4 ë¬¸ì„œí™” (P2)

#### Task 10: API ë¬¸ì„œ ì‘ì„±
- `/docs/api_reference.md`
- Swagger UI í™œìš©
- ì˜ˆì œ ìš”ì²­/ì‘ë‹µ

---

#### Task 11: ê°œë°œì ê°€ì´ë“œ
- `/docs/developer_guide.md`
- ë¡œì»¬ ê°œë°œ í™˜ê²½ ì„¤ì •
- ë””ë²„ê¹… ë°©ë²•
- ì»¤ìŠ¤í…€ í‰ê°€ ë…¸ë“œ ì¶”ê°€ ë°©ë²•

---

#### Task 12: ë°°í¬ ê°€ì´ë“œ
- `/docs/deployment.md`
- Docker Compose ë°°í¬
- í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- ëª¨ë‹ˆí„°ë§ ì„¤ì •

================================================================================
## 7. ìš”ì•½
================================================================================

### âœ… ì™„ë£Œëœ ì‘ì—…
1. âœ… 4ë²ˆ ê°€ë“œ ë…¸ë“œ êµ¬í˜„ (`eval_turn_guard`)
2. âœ… ë°±ê·¸ë¼ìš´ë“œ 4ë²ˆ ë…¸ë“œ ì‹¤í–‰ ë¡œì§ êµ¬í˜„
3. âœ… Redis turn_logs ì €ì¥/ì¡°íšŒ í•¨ìˆ˜ ì¶”ê°€
4. âœ… ì œì¶œ í”Œë¡œìš° ë¼ìš°íŒ… ìˆ˜ì •
5. âœ… ëª¨ë“  ë…¸ë“œì— ìƒì„¸ ë¡œê¹… ì¶”ê°€
6. âœ… messages ì§ë ¬í™” ë¬¸ì œ í•´ê²° (HumanMessage TypeError)
7. âœ… í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± (test_submit_only.py, test_chat_flow.py)
8. âœ… **í„´-ë©”ì‹œì§€ ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬í˜„** (`turn_mapping:{session_id}`)
9. âœ… **ê°€ë“œë ˆì¼ ìœ„ë°˜ í„´ í‰ê°€ ì‹œìŠ¤í…œ êµ¬í˜„**
10. âœ… **Writer LLM ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ê°œì„ ** (ì†Œí¬ë¼í…ŒìŠ¤ì‹ + êµìœ¡ì  ê±°ì ˆ)

### âŒ ë¯¸ì™„ë£Œ/ë¬¸ì œ
1. âŒ messages ë°°ì—´ì— turn ì •ë³´ ë³´ì¡´ ì‹¤íŒ¨ (í•µì‹¬ ë¬¸ì œ)
2. âŒ Turn 1 ë°±ê·¸ë¼ìš´ë“œ í‰ê°€ ëˆ„ë½
3. âŒ turn_scoresì— ì¼ë¶€ í„´ë§Œ ë°˜ì˜
4. âš ï¸  PostgreSQL ERD ë¯¸ë¬¸ì„œí™”
5. âš ï¸  Redis í‚¤ êµ¬ì¡° ë¹„í‘œì¤€í™”
6. âš ï¸  Judge0 API ë¯¸ì—°ë™

### ğŸ¯ ìš°ì„ ìˆœìœ„
1. **P0 (ê¸´ê¸‰)**: messages ë°°ì—´ turn ì •ë³´ ë³´ì¡´ â†’ 4ë²ˆ ê°€ë“œ ì •ìƒ ì‘ë™
2. **P1 (ì¤‘ìš”)**: DB êµ¬ì¡° ë¬¸ì„œí™”, Judge0 ì—°ë™
3. **P2 (ì¶”ê°€)**: ì„±ëŠ¥ ìµœì í™”, ë¬¸ì„œ ì‘ì„±

### ğŸ“Š í˜„ì¬ ìƒíƒœ (2025-11-27 ì—…ë°ì´íŠ¸)
```
ì „ì²´ í”Œë¡œìš°: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90% (â–² +10%)
  - ì¼ë°˜ ì±„íŒ…: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90% (â–² +20%, ê°€ë“œë ˆì¼ í‰ê°€ ì¶”ê°€)
  - ì œì¶œ í”Œë¡œìš°: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90% (â–² +10%, í„´ ë§¤í•‘ ì‹œìŠ¤í…œ)
  - ë¡œê¹…: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  - í…ŒìŠ¤íŠ¸: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%
  
í•µì‹¬ ê¸°ëŠ¥: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (â–² +20%)
  - ì˜ë„ ë¶„ì„: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  - AI ë‹µë³€ ìƒì„±: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (ì†Œí¬ë¼í…ŒìŠ¤ì‹ ê°œì„ )
  - ê°€ë“œë ˆì¼ í‰ê°€: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (â˜… ì‹ ê·œ)
  - í„´ í‰ê°€: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 90% (â–² +10%, ì¬í‰ê°€ ê°€ëŠ¥)
  - ì½”ë“œ í‰ê°€: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60% (Judge0 ë¯¸ì—°ë™)
  - ìµœì¢… ì§‘ê³„: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%

ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥:
  âœ… í„´-ë©”ì‹œì§€ ë§¤í•‘ ì‹œìŠ¤í…œ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  âœ… ê°€ë“œë ˆì¼ ìœ„ë°˜ í‰ê°€: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  âœ… êµìœ¡ì  ê±°ì ˆ ë©”ì‹œì§€: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
  âš ï¸  ì¬í‰ê°€ ì•ˆì •ì„±: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (ì„œë²„ ì¬ì‹œì‘ í›„ í…ŒìŠ¤íŠ¸ í•„ìš”)
```

================================================================================
                            END OF DOCUMENT
================================================================================

